"use strict";!function(a){var b=a.$,c=b.Deferred,d=a.utils,e=a.dataSource,f=e.utils,g=a.constants,h=g.DISPLAY_TYPES,i=g.MIME_TYPES,j=g.HTTP_VERBS,k=a.ui.getFieldRenderer,l=i.JSON,m=h.DATETIME,n=h.NUMBER,o=h.OBJECT,p=h.STRING,q=h.BOOLEAN,r=h.TEXT,s=j.GET,t=j.POST,u=j.PATCH,v=j.DELETE,w="https://graph.microsoft.com/v1.0",x=f.getModelMergeConditions,y={urlEncode:!1},z=function(a){var b=a.model,c=x(b,a,y),d=c.parent;"parent"in c&&d?-1!==d.indexOf(".")?(a.request.url="/me/drive/root:"+d,a.request.pathToContent=""):(a.request.url="/me/drive/root:"+d+":/children",a.request.pathToContent="value"):"parent"in c&&(a.request.url="/me/drive/root/children",a.request.pathToContent="value")},A=function(a,c){var d=a.model,e=x(d,a,y),f=c.getEntityMetadataCacheKey(d),g=e.file,h=e.worksheet,i=a.row.rowRange;if("TableRange"===f||"Range"===f){var j=a.row.formulas,k=[];b.each(a.request.data,function(a,b){j[a]=b}),b.each(j,function(a,b){k.push(b)}),a.request.data={formulas:[k]},a.request.url="/me/drive/items/"+g+"/workbook/worksheets('"+h+"')/range(address='"+i+"')"}},B=function(a,c,d){b.each(a.picklistEntries,function(a,e){d===e.value&&e.args&&b.each(e.args,function(a,b){c.push(b)})})};e.getDataSourceType("MicrosoftExcel")||new e.core.RESTDataSourceTypeBase({name:"MicrosoftExcel",coerceRequest:function(a){var b=a.type;"query"===b?z(a):"update"===b&&A(a,this),a.request.headers={Accept:l,"Content-Type":"application/json","Content-Length":0}},parseSuccessfulLoadResponse:function(a,c,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=this,t=s.parseResponseBodyAsJSON(a.body),u=x(f,{model:f},y),v=u.hasHeader,w=c.pathToContent,z=w?d.getObjectProperty(t,w):t,A=this.getEntityMetadataCacheKey(f),B=[];if("Workbook"===A)if(z.value&&b.isArray(z.value))b.each(z.value,function(a,b){if(-1===b.name.split(".").slice(-1)[0].indexOf("xlsx"))delete z[a];else{var c=b.parentReference.path,e=c?c.split(":")[1]:b.parentReference.id;b.createdByUserName=d.getObjectProperty(b,"createdBy.user.displayName"),b.lastModifiedByUserName=d.getObjectProperty(b,"lastModifiedBy.user.displayName"),b.parentDirectory=e,b.oneUp=e.substring(0,e.lastIndexOf("/")),B.push(b)}}),e.data=z=B;else{var C=z.parentReference.path,D=C?C.split(":")[1]:z.parentReference.id;z.createdByUserName=d.getObjectProperty(z,"createdBy.user.displayName"),z.lastModifiedByUserName=d.getObjectProperty(z,"lastModifiedBy.user.displayName"),z.parentDirectory=D,z.oneUp=D.substring(0,D.lastIndexOf("/")),e.data=z=[z]}else e.isRangeEntity?(i=t.formulas,j=t.values,h=[],k=t.address.split("!"),l=k[1],"true"===v?(h=z[0],z.shift()):(g.sort(function(a,b){return a.column-b.column}),b.each(g,function(a,b){h.push(b.label)})),m=l.split(":"),n=[],o=[],p=0,r=0,b.each(m,function(a,b){o[a]=b.replace(/[^0-9]/,""),n[a]=b.replace(/[0-9]/g,"")}),b.each(j,function(a,c){var d="true"===v?i[a+1]:i[a],e={};0===r&&(q=parseInt(o[0],10)),"true"===v&&0===r&&(q+=1),p!==a&&(q+=1),b.each(c,function(a){e[h[a].replace(" ","")]=d[a]});var f=-1===l.indexOf(":")?n[0]+q:n[0]+q+":"+n[1]+q;B[a]={rowRange:f,formulas:e},b.each(c,function(b,c){B[a][h[b].replace(" ","")]=c}),p!=a&&(p=a),r=1}),z=B,e.data=z):e.data=z},parseSuccessfulSaveResponse:function(a,c){var d="string"==typeof a.body?JSON.parse(a.body):a.body,e=c.model,f=e.fields;if(e.isRangeEntity){var g=d.address.split("!"),h={formulas:{},rowRange:g[1]};f.sort(function(a,b){return a.column-b.column}),b.each(f,function(a,b){h[b.id]=d.values[0][a],h.formulas[b.id]=d.formulas[0][a]}),a.body=h}},queryEntityMetadata:function(a){var c=this,d=b.Deferred(),e=this.getEntityMetadataCacheKey(a),f=this.prop("x-metadata")[e],g=f.methods.query,h={url:g.url,method:g.verb,contentType:g.contentType,scopes:g.scopes,headers:{Accept:l}},i={type:"query",method:g,model:a,request:h},j=a.conditions,k=j?x(a,i,y):{},m=k.hasHeader;return f.isRangeEntity?"string"==typeof a?d.resolve(f):c.makeRequest(a,i).then(function(a){var e=c.parseResponseBodyAsJSON(a.body);if("true"===m)b.each(e.values[0],function(a,b){f.fields[a]={id:b.replace(" ",""),label:b,column:a,displaytype:"FORMULA",accessible:!0,createable:!1,editable:!0,"x-alwaysinclude":!0}});else{var g,h=e.values,i=e.address.split("!"),j=i[1],k=j.split(":"),l=[],n=[],o=0;b.each(k,function(a,b){n[a]=b.replace(/[^0-9]/,""),l[a]=b.replace(/[0-9]/g,"")}),b.each(h[0],function(a){g&&0!==o||(g=l[0]),f.fields[a]={id:"Column"+g,label:"Column "+g,column:a,displaytype:"FORMULA",accessible:!0,createable:!1,editable:!0,"x-alwaysinclude":!0},g=g.substring(0,g.length-1)+String.fromCharCode(g.charCodeAt(g.length-1)+1),o++})}return d.resolve(f)}):d.resolve(f)},createActions:function(d,e,f){function g(a,b){return a||b.getFirstRow().id}f=f||{};var h={label:"Number",id:"arg1",name:"number",type:"string",valueType:"number"},i={label:"Range",id:"arg1",name:"range",type:"string",valueType:"range"},j={label:"Workbook ID",id:"workbook",type:"text"},k=[{value:"abs",label:"ABS()",args:[h]},{value:"acos",label:"ACOS()",args:[h]},{value:"acosh",label:"ACOSH()",args:[h]},{value:"acot",label:"ACOT()",args:[h]},{value:"acoth",label:"ACOTH()",args:[h]},{value:"asin",label:"ASIN()",args:[h]},{value:"asinh",label:"ASINH()",args:[h]},{value:"atan",label:"ATAN()",args:[h]},{value:"atanh",label:"ATANH()",args:[h]},{value:"average",label:"AVERAGE()",args:[i]},{value:"cos",label:"COS()",args:[h]},{value:"cosh",label:"COSH()",args:[h]},{value:"cot",label:"COT()",args:[h]},{value:"coth",label:"COTH()",args:[h]},{value:"csc",label:"CSC()",args:[h]},{value:"csch",label:"CSCH()",args:[h]},{value:"max",label:"MAX()",args:[i]},{value:"median",label:"MEDIAN()",args:[i]},{value:"min",label:"MIN()",args:[i]},{value:"mode",label:"MODE()",args:[i]},{value:"pi",label:"PI()"},{value:"sin",label:"SIN()",args:[h]},{value:"sinh",label:"SINH()",args:[h]},{value:"sqrt",label:"SQRT()",args:[h]},{value:"sqrtpi",label:"SQRTPI()"},{value:"sum",label:"SUM()",args:[i]},{value:"round",label:"ROUND()",args:[h]},{value:"rounddown",label:"ROUNDDOWN()",args:[h]},{value:"roundup",label:"ROUNDUP()",args:[h]}];if(a.builder){var m=f.component,n=[j,{label:"Function Name",id:"function",type:"picklist",picklistEntries:k,onChange:function(a){n.splice(2),B(this,n,a),m.rebuildProps()}}],o=[j,{label:"Range",id:"range",name:"range",type:"string"},{label:"Has Headers",id:"headers",type:"boolean"}],p=[j,{label:"Worksheet Name or ID",id:"worksheet",type:"text"},{label:"Chart Type",id:"charttype",type:"picklist",picklistEntries:[{value:"ColumnClustered",label:"Clustered Column"},{value:"ColumnStacked",label:"Stacked Column"},{value:"ColumnStacked100",label:"100% Stacked Column"},{value:"Line",label:"Line"},{value:"LineStacked",label:"Stacked Line"},{value:"LineStacked100",label:"100% Stacked Line"},{value:"LineMarkers",label:"Line with Markers"},{value:"LineMarkersStacked",label:"Stacked Line with Markers"},{value:"LineMarkersStacked100",label:"100% Stacked Line with Markers"},{value:"PieOfPie",label:"Pie"},{value:"Doughnut",label:"Doughnut"},{value:"BarClustered",label:"Clustered Bar"},{value:"BarStacked",label:"Stacked Bar"},{value:"BarStacked100",label:"100% Stacked Bar"},{value:"Area",label:"Area"},{value:"AreaStacked",label:"Stacked Area"},{value:"AreaStacked100",label:"100% Stacked Area"},{value:"XYScatter",label:"Scatter with only Markers"},{value:"XYScatterSmooth",label:"Scatter with Smooth Lines and Markers"},{value:"XYScatterSmoothNoMarkers",label:"Scatter with Smooth Lines"},{value:"XYScatterLines",label:"Scatter with Straight Lines and Markers"},{value:"XYScatterLinesNoMarkers",label:"Scatter with Straight Lines"},{value:"Radar",label:"Radar"},{value:"RadarFilled",label:"Filled Radar"},{value:"RadarMarkers",label:"Radar with Markers"}]},{label:"Source Data",id:"sourcedata",type:"text"},{label:"Chart Series By",id:"seriesby",type:"picklist",defaultValue:"Auto",picklistEntries:[{value:"Auto",label:"Auto"},{value:"Columns",label:"Columns"},{value:"Rows",label:"Rows"}]}];B(n[1],n,e.attr("function"))}return{"function":{label:"Excel Function",builderProps:n||"",runtimeExecution:function(d,e,f,h){var i=c(),j={},l=g(d.attr("workbook"),a.$M(d.attr("model")));return b.each(k,function(a,c){c.value===d.attr("function")&&c.args&&b.each(c.args,function(a,c){var e=d.attr(c.id);"number"===c.valueType?j[c.name]=e:"range"===c.valueType&&(j.values=[],-1!==e.indexOf(",")?b.each(e.split(","),function(a,b){b.match(/[a-z]/i)?j.values.push({address:b}):j.values.push(b)}):j.values.push({address:e}))})}),b.ajax({url:w+"/me/drive/items/"+l+"/workbook/functions/"+d.attr("function"),headers:{Authorization:"Bearer "+h.authentication.responseBody.access_token,"Content-Type":"application/json",Accept:"application/json"},method:"POST",dataType:"json",data:JSON.stringify(j),success:function(a){i.resolve({$Excel:a})},error:function(a){i.reject(a)}}),i.promise()}},"create-table":{label:"Create Excel Table",builderProps:o||"",runtimeExecution:function(d,e,f,h){var i=c(),j={address:d.attr("range"),hasHeaders:"true"===d.attr("headers")},k=g(d.attr("workbook"),a.$M(d.attr("model")));return b.ajax({url:w+"/me/drive/items/"+k+"/workbook/tables/add",headers:{Authorization:"Bearer "+h.authentication.responseBody.access_token,"Content-Type":l,Accept:l},method:t,dataType:"json",data:JSON.stringify(j),success:function(a){i.resolve({$Excel:a})},error:function(a){i.reject(a)}}),i.promise()}},"create-chart":{label:"Create Chart",builderProps:p||"",runtimeExecution:function(d,e,f,h){var i=c(),j={type:d.attr("charttype"),sourceData:d.attr("sourcedata"),seriesBy:d.attr("seriesby")},k=g(d.attr("workbook"),a.$M(d.attr("model")));return b.ajax({url:w+"/me/drive/items/"+k+"/workbook/worksheets('"+d.attr("worksheet")+"')/charts/add",headers:{Authorization:"Bearer "+h.authentication.responseBody.access_token,"Content-Type":l,Accept:l},method:t,dataType:"json",data:JSON.stringify(j),success:function(a){i.resolve({$Excel:a})},error:function(a){i.reject(a)}}),i.promise()}}}},getActions:f.getActionsStatic,getEntityList:f.getEntityListStatic,fieldRenderers:function(){return{FORMULA:{read:function(a,b){k(r).read(a,b)},readonly:function(a,b){k(r).readonly(a,b)},edit:function(a){k(r).edit(a,a.row.formulas[a.id])}}}},extendedProperties:{composer:{unomittableFields:!0,hasEntityOptions:!0},validConditionTypes:["fieldvalue","multiple","param","boolean"],canFieldsBeIndividuallySearched:!0,canServerSearch:!0,"x-metadata":{Workbook:{idFields:["id"],nameField:"name",label:"Workbook",labelPlural:"Workbooks",fields:[{id:"id",label:"Id",displaytype:p,inlineHelpText:"Identifier of the drive.",accessible:!0,createable:!1,editable:!1,"x-alwaysinclude":!0},{id:"name",label:"Name",displaytype:p,inlineHelpText:"Name of the drive.",accessible:!0,createable:!1,editable:!0},{id:"createdByUserName",label:"Created By",displaytype:p,accessible:!0,createable:!1,editable:!1},{id:"createdDateTime",label:"Created Date Time",displaytype:m,accessible:!0,createable:!1,editable:!1},{id:"lastModifiedByUserName",label:"Last Modified By",displaytype:p,accessible:!0,createable:!1,editable:!1},{id:"lastModifiedDateTime",label:"Last Modified",displaytype:m,accessible:!0,createable:!1,editable:!1},{id:"webUrl",label:"Web Url",displaytype:p,accessible:!0,createable:!1,editable:!1},{id:"parentReference",label:"Parent Reference",displaytype:o,accessible:!1,createable:!1,editable:!1},{id:"size",label:"Size",displaytype:n,accessible:!0,createable:!1,editable:!1},{id:"parentDirectory",label:"Parent Directory",displaytype:p,accessible:!0,createable:!1,editable:!0},{id:"oneUp",label:"Directory Up",displaytype:p,accessible:!0,createable:!1,editable:!1}],methods:{query:{url:"",verb:s,contentType:l,pathToContent:""}},defaultConditions:[{sourcetype:"param",sourceparam:"parent",name:"parent",label:"Path to Folder or File",state:"filterableon",value:""}]},Worksheet:{idFields:["id"],nameField:"name",label:"Worksheet",labelPlural:"Worksheets",fields:[{id:"id",label:"Id",displaytype:p,inlineHelpText:"Identifier of the worksheet.",accessible:!0,createable:!1,editable:!1,"x-alwaysinclude":!0},{id:"name",label:"Name",displaytype:p,inlineHelpText:"Name of the worksheet.",accessible:!0,createable:!0,editable:!0,"x-alwaysinclude":!0},{id:"position",label:"Position",displaytype:n,inlineHelpText:"Position of the worksheet in the workbook.",accessible:!0,createable:!1,editable:!0,"x-alwaysinclude":!0},{id:"visibility",label:"Visibility",displaytype:p,inlineHelpText:"Whether the worksheet is visible.",accessible:!0,createable:!1,editable:!0,"x-alwaysinclude":!0}],methods:{query:{url:"/me/drive/items/{{file}}/workbook/worksheets",verb:s,contentType:l,pathToContent:"value"},insert:{url:"/me/drive/items/{{file}}/workbook/worksheets/add",verb:t,contentType:l,receiveDataAs:"recordinbody",successIf:"responsefieldequals",successField:"status",successValue:"Created"},update:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{id}}')",verb:u,contentType:l,receiveDataAs:"recordinbody",successIf:"responsefieldispresent"},"delete":{url:"/me/drive/items/{{file}}/workbook/worksheets('{{id}}')",verb:v,contentType:l,successIf:"responsefieldisempty"}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""}]},Range:{label:"Range",labelPlural:"Ranges",isRangeEntity:!0,fields:[],methods:{query:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/range(address='{{range}}')",verb:s,contentType:l,pathToContent:"values"},update:{url:"",verb:u,contentType:l,pathToContent:""}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"worksheet",name:"worksheet",label:"Worksheet Name or ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"range",name:"range",label:"Cell Range",state:"filterableon",type:"fieldvalue",value:""},{sourcetype:"param",sourceparam:"hasHeader",name:"hasHeader",label:"Has Headers",state:"fixed",type:"boolean",required:!0,value:!1}]},Table:{idFields:["id"],nameField:"name",label:"Table",labelPlural:"Tables",fields:[{id:"id",label:"Id",displaytype:p,inlineHelpText:"Identifier of the table.",accessible:!0,createable:!1,editable:!1,"x-alwaysinclude":!0},{id:"name",label:"Name",displaytype:p,inlineHelpText:"Name of the table.",accessible:!0,createable:!0,editable:!0},{id:"highlightFirstColumn",label:"Highlight First Column",displaytype:q,accessible:!0,createable:!0,editable:!0},{id:"highlightLastColumn",label:"Highlight Last Column",displaytype:q,accessible:!0,createable:!0,editable:!0},{id:"showBandedColumns",label:"Show Banded Columns",displaytype:q,accessible:!0,createable:!0,editable:!0},{id:"showBandedRows",label:"Show Banded Rows",accessible:!0,createable:!0,editable:!0},{id:"showFilterButton",label:"Show Filter Button",accessible:!0,createable:!0,editable:!0},{id:"showHeaders",label:"Show Headers",accessible:!0,createable:!0,editable:!0},{id:"showTotals",label:"Show Totals",accessible:!0,createable:!0,editable:!0},{id:"style",label:"Table Style",accessible:!0,createable:!0,editable:!0}],methods:{query:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/tables",verb:s,contentType:l,pathToContent:"value"},update:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/tables('{{id}}')",verb:u,contentType:l}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"worksheet",name:"worksheet",label:"Worksheet Name or ID",state:"filterableon",type:"fieldvalue",required:!0,value:""}]},TableRange:{label:"TableRange",labelPlural:"TableRanges",isRangeEntity:!0,fields:[],methods:{query:{url:"/me/drive/items/{{file}}/workbook/tables('{{table}}')/Range",verb:s,contentType:l,pathToContent:"values"},update:{url:"",verb:u,contentType:l,pathToContent:""}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"worksheet",name:"worksheet",label:"Worksheet Name or ID",state:"filterableon",type:"fieldvalue",value:""},{sourcetype:"param",sourceparam:"table",name:"table",label:"Table Name or ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"hasHeader",name:"hasHeader",label:"Has Headers",state:"fixed",type:"boolean",required:!0,value:!0}]},Chart:{idFields:["id"],nameField:"name",label:"Chart",labelPlural:"Charts",fields:[{id:"id",label:"Id",displaytype:p,inlineHelpText:"Identifier of the chart.",accessible:!0,createable:!1,editable:!1,"x-alwaysinclude":!0},{id:"name",label:"Name",displaytype:p,inlineHelpText:"Name of the chart.",accessible:!0,createable:!0,editable:!0},{id:"height",label:"Height",displaytype:n,accessible:!0,createable:!1,editable:!1},{id:"width",label:"Width",displaytype:n,accessible:!0,createable:!1,editable:!1},{id:"top",label:"Top",displaytype:n,accessible:!0,createable:!1,editable:!1},{id:"left",label:"Left",displaytype:n,accessible:!0,createable:!1,editable:!1}],methods:{query:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/charts",verb:s,contentType:l,pathToContent:"value"},update:{url:"/me/drive/items/{{file}}/workbook/worksheets('{{worksheet}}')/charts('{{name}}')",verb:u,contentTYpe:l},"delete":{url:"/me/drive/items/{{file}}/workbook/charts('{{name}}')/delete",verb:t,contentType:l,successIf:"responsebodyisempty"}},defaultConditions:[{sourcetype:"param",sourceparam:"file",name:"file",label:"File ID",state:"filterableon",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"worksheet",name:"worksheet",label:"Worksheet Name or ID",state:"filterableon",type:"fieldvalue",value:""}]}}}})}(skuid);