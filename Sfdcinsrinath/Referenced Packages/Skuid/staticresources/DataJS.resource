"use strict";!function(a,b){var c=a.datajs||{},d=a.OData||{};"function"==typeof define&&define.amd?(define("datajs",c),define("OData",d)):(a.datajs=c,a.OData=d),c.version={major:1,minor:1,build:1};var e=function(b){return a.ActiveXObject?new a.ActiveXObject(b):null},f=function(a){return null!==a&&void 0!==a},g=function(a,b){var c,d;for(c=0,d=a.length;c<d;c++)if(a[c]===b)return!0;return!1},h=function(a,b){return void 0!==a?a:b},i=function(b){if(1===arguments.length)return void a.setTimeout(b,0);var c=Array.prototype.slice.call(arguments,1);a.setTimeout(function(){b.apply(this,c)},0)},j=function(a,b){for(var c in b)a[c]=b[c];return a},k=function(a,b){if(a){var c,d;for(c=0,d=a.length;c<d;c++)if(b(a[c]))return a[c]}return null},l=function(a){return"[object Array]"===Object.prototype.toString.call(a)},m=function(a){return"[object Date]"===Object.prototype.toString.call(a)},n=function(a){return"object"==typeof a},o=function(a){return parseInt(a,10)},p=function(a,b,c){a.hasOwnProperty(b)&&(a[c]=a[b],delete a[b])},q=function(a){throw a},r=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},s=function(a,b){return void 0!==a?a:b},t=/^([^:\/?#]+:)?(\/\/[^\/?#]*)?([^?#:]+)?(\?[^#]*)?(#.*)?/,u=["scheme","authority","path","query","fragment"],v=function(a){var b={isAbsolute:!1};if(a){var c=t.exec(a);if(c){var d,e;for(d=0,e=u.length;d<e;d++)c[d+1]&&(b[u[d]]=c[d+1])}b.scheme&&(b.isAbsolute=!0)}return b},w=function(a){return"".concat(a.scheme||"",a.authority||"",a.path||"",a.query||"",a.fragment||"")},x=/^\/{0,2}(?:([^@]*)@)?([^:]+)(?::{1}(\d+))?/,y=/%[0-9A-F]{2}/gi,z=function(a){var b=v(a),c=b.scheme,d=b.authority;if(c&&(b.scheme=c.toLowerCase(),d)){var e=x.exec(d);e&&(b.authority="//"+(e[1]?e[1]+"@":"")+e[2].toLowerCase()+(e[3]?":"+e[3]:""))}return a=w(b),a.replace(y,function(a){return a.toLowerCase()})},A=function(a,b){if(!b)return a;var c=v(a);if(c.isAbsolute)return a;var d,e=v(b),f={};return c.authority?(f.authority=c.authority,d=c.path,f.query=c.query):(c.path?(d="/"===c.path.charAt(0)?c.path:B(c.path,e.path),f.query=c.query):(d=e.path,f.query=c.query||e.query),f.authority=e.authority),f.path=C(d),f.scheme=e.scheme,f.fragment=c.fragment,w(f)},B=function(a,b){var c,d="/";return b&&(c=b.lastIndexOf("/"),d=b.substring(0,c),"/"!==d.charAt(d.length-1)&&(d+="/")),d+a},C=function(a){for(var b,c="",d="";a;)0===a.indexOf("..")||0===a.indexOf(".")?a=a.replace(/^\.\.?\/?/g,""):0===a.indexOf("/..")?(a=a.replace(/^\/\..\/?/g,"/"),b=c.lastIndexOf("/"),c=-1===b?"":c.substring(0,b)):0===a.indexOf("/.")?a=a.replace(/^\/\.\/?/g,"/"):(d=a,b=a.indexOf("/",1),-1!==b&&(d=a.substring(0,b)),c+=d,a=a.replace(d,""));return c},D=function(b){var c=[];if(void 0===a.atob)c=E(b);else for(var d=a.atob(b),e=0;e<d.length;e++)c.push(d.charCodeAt(e));for(var f="",g=0;g<c.length;g++){var h=c[g];f+="0123456789ABCDEF"[h>>4],f+="0123456789ABCDEF"[15&h]}return f},E=function(a){for(var b="",c=0;c<a.length;c++){var d=F(a[c]),e="";null!==d&&(e=d.toString(2),b+=G(e))}var f=[],g=parseInt(b.length/8,10);for(c=0;c<g;c++){var h=parseInt(b.substring(8*c,8*(c+1)),2);f.push(h)}return f},F=function(a){var b=a.charCodeAt(0);return b>=65&&b<=90?b-65:b>=97&&b<=122?b-65-6:b>=48&&b<=57?b+4:"+"==a?62:"/"==a?63:null},G=function(a){for(;a.length<6;)a="0"+a;return a},H="http://",I=H+"www.w3.org/",J=I+"1999/xhtml",K=I+"2000/xmlns/",L=I+"XML/1998/namespace",M=function(a){return/(^\s)|(\s$)/.test(a)},N=function(a){var b=/^\s*$/;return null===a||b.test(a)},O=function(a){for(;null!==a&&1===a.nodeType;){var b=Z(a,"space",L);if("preserve"===b)return!0;if("default"===b)break;a=a.parentNode}return!1},P=function(a){var b=a.nodeName;return"xmlns"==b||0===b.indexOf("xmlns:")},Q=function(a,b,c){try{a.setProperty(b,c)}catch(d){}},R=function(){var a=e("Msxml2.DOMDocument.3.0");return a&&(Q(a,"ProhibitDTD",!0),Q(a,"MaxElementDepth",256),Q(a,"AllowDocumentFunction",!1),Q(a,"AllowXsltScript",!1)),a},S=function(){try{var a=e("Msxml2.DOMDocument.6.0");return a&&(a.async=!0),a}catch(b){return R()}},T=function(a){var b=S();if(!b)return null;b.loadXML(a);var c=b.parseError;return 0!==c.errorCode&&U(c.reason,c.srcText,a),b},U=function(a,b,c){throw"string"==typeof a&&(a={message:a}),j(a,{srcText:b||"",errorXmlText:c||""})},V=function(b){var c,d=a.DOMParser&&new a.DOMParser;if(!d)return c=T(b),c||U("XML DOM parser not supported"),c;try{c=d.parseFromString(b,"text/xml")}catch(m){U(m,"",b)}var e=c.documentElement,f=e.namespaceURI,g=ha(e);if("parsererror"===g&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"===f){var h=da(e,"http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext"),i=h?ja(h):"";U(ga(e)||"",i,b)}if("h3"===g&&f===J||ea(e,J,"h3")){for(var j="",k=[],l=e.firstChild;l;)1===l.nodeType&&(j+=ga(l)||""),k.push(l.nextSibling),l=l.firstChild||k.shift();j+=ga(e)||"",U(j,"",b)}return c},W=function(a,b){return a?a+":"+b:b},X=function(a,b){if(M(b.data)){var c=$(a,L,"space");c||(c=pa(a.ownerDocument,L,W("xml","space")),oa(a,c)),c.value="preserve"}return a.appendChild(b),a},Y=function(a,b){var c,d,e=a.attributes;for(c=0,d=e.length;c<d;c++)b(e.item(c))},Z=function(a,b,c){var d=$(a,b,c);return d?ja(d):null},$=function(a,b,c){var d=a.attributes;return d.getNamedItemNS?d.getNamedItemNS(c||null,b):d.getQualifiedItem(b,c)||null},_=function(a,b){var c=$(a,"base",L);return(c?A(c.value,b):b)||null},aa=function(a,b){ka(a,!1,function(a){return 1===a.nodeType&&b(a),!0})},ba=function(a,b,c){var d,e,f=c.split("/");for(d=0,e=f.length;d<e;d++)a=a&&da(a,b,f[d]);return a||null},ca=function(a,b,c){var d=c.lastIndexOf("/"),e=c.substring(d+1),f=c.substring(0,d),g=f?ba(a,b,f):a;return g?"@"===e.charAt(0)?$(g,e.substring(1),b):da(g,b,e):null},da=function(a,b,c){return fa(a,b,c,!1)},ea=function(a,b,c){if(a.getElementsByTagNameNS){var d=a.getElementsByTagNameNS(b,c);return d.length>0?d[0]:null}return fa(a,b,c,!0)},fa=function(a,b,c,d){var e=null;return ka(a,d,function(a){if(1===a.nodeType){var d=!b||ia(a)===b,f=!c||ha(a)===c;d&&f&&(e=a)}return null===e}),e},ga=function(a){var b,c=null,d=9===a.nodeType&&a.documentElement?a.documentElement:a,e=!1===d.ownerDocument.preserveWhiteSpace;return ka(d,!1,function(a){if(3===a.nodeType||4===a.nodeType){var f=ja(a),g=e||!N(f);g||(void 0===b&&(b=O(d)),g=b),g&&(c?c+=f:c=f)}return!0}),c},ha=function(a){return a.localName||a.baseName},ia=function(a){return a.namespaceURI||null},ja=function(a){return 1===a.nodeType?ga(a):a.nodeValue},ka=function(a,b,c){for(var d=[],e=a.firstChild,f=!0;e&&f;)(f=c(e))&&(b&&e.firstChild&&d.push(e.firstChild),e=e.nextSibling||d.shift())},la=function(a,b,c){for(var d=a.nextSibling;d;){if(1===d.nodeType){var e=!b||ia(d)===b,f=!c||ha(d)===c;if(e&&f)return d}d=d.nextSibling}return null},ma=function(){var b=a.document.implementation;return b&&b.createDocument?b.createDocument(null,null,null):S()},na=function(a,b){if(!l(b))return oa(a,b);var c,d;for(c=0,d=b.length;c<d;c++)b[c]&&oa(a,b[c]);return a},oa=function(a,b){if(b){if("string"==typeof b)return X(a,ta(a.ownerDocument,b));2===b.nodeType?a.setAttributeNodeNS?a.setAttributeNodeNS(b):a.setAttributeNode(b):a.appendChild(b)}return a},pa=function(a,b,c,d){var e=a.createAttributeNS&&a.createAttributeNS(b,c)||a.createNode(2,c,b||void 0);return e.value=d||"",e},qa=function(a,b,c,d){var e=a.createElementNS&&a.createElementNS(b,c)||a.createNode(1,c,b||void 0);return na(e,d||[])},ra=function(a,b,c){return pa(a,K,W("xmlns",c),b)},sa=function(a,b){for(var c="<c>"+b+"</c>",d=V(c),e=d.documentElement,f=("importNode"in a?a.importNode(e,!0):e),g=a.createDocumentFragment(),h=f.firstChild;h;)g.appendChild(h),h=h.nextSibling;return g},ta=function(a,b){return a.createTextNode(b)},ua=function(a,b,c,d,e){var f,g,h="",i=e.split("/"),j=da,k=qa,l=b;for(f=0,g=i.length;f<g;f++){h=i[f],"@"===h.charAt(0)&&(h=h.substring(1),j=$,k=pa);var m=j(l,c,h);m||(m=k(a,c,W(d,h)),oa(l,m)),l=m}return l},va=function(b){var c=a.XMLSerializer;if(c){return(new c).serializeToString(b)}if(b.xml)return b.xml;throw{message:"XML serialization unsupported"}},wa=function(a){var b,c=a.childNodes,d=c.length;if(0===d)return"";var e=a.ownerDocument,f=e.createDocumentFragment(),g=e.createElement("c");for(f.appendChild(g),b=0;b<d;b++)g.appendChild(c[b]);var h=va(f);for(h=h.substr(3,h.length-7),b=0;b<d;b++)a.appendChild(g.childNodes[b]);return h},xa=function(a,b,c){return function(){return a[b].apply(a,arguments),c}},ya=function(){this._arguments=void 0,this._done=void 0,this._fail=void 0,this._resolved=!1,this._rejected=!1};ya.prototype={then:function(a,b){return a&&(this._done?this._done.push(a):this._done=[a]),b&&(this._fail?this._fail.push(b):this._fail=[b]),this._resolved?this.resolve.apply(this,this._arguments):this._rejected&&this.reject.apply(this,this._arguments),this},resolve:function(){if(this._done){var a,b;for(a=0,b=this._done.length;a<b;a++)this._done[a].apply(null,arguments);this._done=void 0,this._resolved=!1,this._arguments=void 0}else this._resolved=!0,this._arguments=arguments},reject:function(){if(this._fail){var a,b;for(a=0,b=this._fail.length;a<b;a++)this._fail[a].apply(null,arguments);this._fail=void 0,this._rejected=!1,this._arguments=void 0}else this._rejected=!0,this._arguments=arguments},promise:function(){var a={};return a.then=xa(this,"then",a),a}};var za=function(){return a.jQuery&&a.jQuery.Deferred?new a.jQuery.Deferred:new ya},Aa=function(a,b){return(a&&a.__metadata||{}).type||(b?b.type:null)},Ba=["Edm.String","Edm.Int32","Edm.Int64","Edm.Boolean","Edm.Double","Edm.Single","Edm.DateTime","Edm.DateTimeOffset","Edm.Time","Edm.Decimal","Edm.Guid","Edm.Byte","Edm.Int16","Edm.SByte","Edm.Binary"],Ca=["Edm.Geometry","Edm.GeometryPoint","Edm.GeometryLineString","Edm.GeometryPolygon","Edm.GeometryCollection","Edm.GeometryMultiPolygon","Edm.GeometryMultiLineString","Edm.GeometryMultiPoint"],Da=["Edm.Geography","Edm.GeographyPoint","Edm.GeographyLineString","Edm.GeographyPolygon","Edm.GeographyCollection","Edm.GeographyMultiPolygon","Edm.GeographyMultiLineString","Edm.GeographyMultiPoint"],Ea=function(a,b){if(!a)return null;if(l(a)){var c,d,e;for(c=0,d=a.length;c<d;c++)if(e=Ea(a[c],b))return e;return null}return a.dataServices?Ea(a.dataServices.schema,b):b(a)},Fa=function(a,b){return a=0===a?"":"."+Ia(a.toString(),3),b>0&&(""===a&&(a=".000"),a+=Ia(b.toString(),4)),a},Ga=function(a){if("string"==typeof a)return a;var b=Ra(a),c=Ja(a.__offset);if(b&&"Z"!==c){a=new Date(a.valueOf());var d=wb(c),e=a.getUTCHours()+d.d*d.h,f=a.getUTCMinutes()+d.d*d.m;a.setUTCHours(e,f)}else b||(c="");var g=a.getUTCFullYear(),h=a.getUTCMonth()+1,i="";g<=0&&(g=-(g-1),i="-");var j=Fa(a.getUTCMilliseconds(),a.__ns);return i+Ia(g,4)+"-"+Ia(h,2)+"-"+Ia(a.getUTCDate(),2)+"T"+Ia(a.getUTCHours(),2)+":"+Ia(a.getUTCMinutes(),2)+":"+Ia(a.getUTCSeconds(),2)+j+c},Ha=function(a){var b=a.ms,c="";b<0&&(c="-",b=-b);var d=Math.floor(b/864e5);b-=864e5*d;var e=Math.floor(b/36e5);b-=36e5*e;var f=Math.floor(b/6e4);b-=6e4*f;var g=Math.floor(b/1e3);return b-=1e3*g,c+"P"+Ia(d,2)+"DT"+Ia(e,2)+"H"+Ia(f,2)+"M"+Ia(g,2)+Fa(b,a.ns)+"S"},Ia=function(a,b,c){for(var d=a.toString(10);d.length<b;)c?d+="0":d="0"+d;return d},Ja=function(a){return a&&"Z"!==a&&"+00:00"!==a&&"-00:00"!==a?a:"Z"},Ka=function(a){if("string"==typeof a){var b=a.indexOf(")",10);if(0===a.indexOf("Collection(")&&b>0)return a.substring(11,b)}return null},La=function(a,b,c,d,e,f){return e.request(a,function(e){try{e.headers&&ob(e.headers),void 0===e.data&&204!==e.statusCode&&d.read(e,f)}catch(g){return void 0===g.request&&(g.request=a),void 0===g.response&&(g.response=e),void c(g)}b(e.data,e)},c)},Ma=function(a){return Qa(a)&&l(a.__batchRequests)},Na=/Collection\((.*)\)/,Oa=function(a,b){var c=a&&a.results||a;return!!c&&Pa(b)||!b&&l(c)&&!Qa(c[0])},Pa=function(a){return Na.test(a)},Qa=function(a){return!!a&&n(a)&&!l(a)&&!m(a)},Ra=function(a){return"Edm.DateTimeOffset"===a.__edmType||!a.__edmType&&a.__offset},Sa=function(a){if(!a&&!Qa(a))return!1;var b=a.__metadata||{},c=a.__deferred||{};return!b.type&&!!c.uri},Ta=function(a){return Qa(a)&&a.__metadata&&"uri"in a.__metadata},Ua=function(a,b){var c=a&&a.results||a;return l(c)&&!Pa(b)&&Qa(c[0])},Va=function(a){return g(Da,a)},Wa=function(a){return g(Ca,a)},Xa=function(a){if(!a&&!Qa(a))return!1;var b=a.__metadata,c=a.__mediaresource;return!b&&!!c&&!!c.media_src},Ya=function(a){return m(a)||"string"==typeof a||"number"==typeof a||"boolean"==typeof a},Za=function(a){return g(Ba,a)},$a=function(a,b){return Sa(a)?"deferred":Ta(a)?"entry":Ua(a)?"feed":b&&b.relationship?null!==a&&void 0!==a&&Ua(a)?"feed":"entry":null},_a=function(a,b){return k(a,function(a){return a.name===b})},ab=function(a,b,c){return a?Ea(b,function(b){return lb(a,b,c)}):null},bb=function(a,b){return k(a,function(a){return a.name===b})},cb=function(a,b){return ab(a,b,"complexType")},db=function(a,b){return ab(a,b,"entityType")},eb=function(a){return Ea(a,function(a){return k(a.entityContainer,function(a){return pb(a.isDefaultEntityContainer)})})},fb=function(a,b){return ab(a,b,"entityContainer")},gb=function(a,b){return k(a,function(a){return a.name===b})},hb=function(a,b){var c=null;if(a){var d=a.relationship,e=Ea(b,function(a){var b=kb(a.namespace,d),c=a.association;if(b&&c){var e,f;for(e=0,f=c.length;e<f;e++)if(c[e].name===b)return c[e]}return null});if(e){var f=e.end[0];f.role!==a.toRole&&(f=e.end[1]),c=f.type}}return c},ib=function(a,b,c){if(a){var d=a.relationship,e=Ea(c,function(a){for(var b=a.entityContainer,c=0;c<b.length;c++){var e=b[c].associationSet;if(e)for(var f=0;f<e.length;f++)if(e[f].association==d)return e[f]}return null});if(e&&e.end[0]&&e.end[1])return e.end[0].entitySet==b?e.end[1].entitySet:e.end[0].entitySet}return null},jb=function(a,b){return Ea(b,function(b){for(var c=b.entityContainer,d=0;d<c.length;d++){var e=c[d].entitySet;if(e)for(var f=0;f<e.length;f++)if(e[f].name==a)return{entitySet:e[f],containerName:c[d].name,functionImport:c[d].functionImport}}return null})},kb=function(a,b){return 0===b.indexOf(a)&&"."===b.charAt(a.length)?b.substr(a.length+1):null},lb=function(a,b,c){if(a&&b){var d=kb(b.namespace,a);if(d)return k(b[c],function(a){return a.name===d})}return null},mb=function(a,b){if(a===b)return a;for(var c=a.split("."),d=b.split("."),e=c.length>=d.length?c.length:d.length,f=0;f<e;f++){var g=c[f]&&o(c[f]),h=d[f]&&o(d[f]);if(g>h)return a;if(g<h)return b}},nb={accept:"Accept","content-type":"Content-Type",dataserviceversion:"DataServiceVersion",maxdataserviceversion:"MaxDataServiceVersion"},ob=function(a){for(var b in a){var c=b.toLowerCase(),d=nb[c];if(d&&b!==d){var e=a[b];delete a[b],a[d]=e}}},pb=function(a){return"boolean"==typeof a?a:"string"==typeof a&&"true"===a.toLowerCase()},qb=/^(-?\d{4,})-(\d{2})-(\d{2})T(\d{2}):(\d{2})(?::(\d{2}))?(?:\.(\d+))?(.*)$/,rb=function(a,b,c){var d=qb.exec(a),e=d?Ja(d[8]):null;if(!d||!b&&"Z"!==e){if(c)return null;throw{message:"Invalid date/time value"}}var f=o(d[1]);f<=0&&f++;var g=d[7],h=0;if(g){if(g.length>7){if(c)return null;throw{message:"Cannot parse date/time value to given precision."}}h=Ia(g.substring(3),4,!0),g=Ia(g.substring(0,3),3,!0),g=o(g),h=o(h)}else g=0;var i=o(d[4]),j=o(d[5]),k=o(d[6])||0;if("Z"!==e){var l=wb(e),m=-l.d;i+=l.h*m,j+=l.m*m}var n=new Date;if(n.setUTCFullYear(f,o(d[2])-1,o(d[3])),n.setUTCHours(i,j,k,g),isNaN(n.valueOf())){if(c)return null;throw{message:"Invalid date/time value"}}return b&&(n.__edmType="Edm.DateTimeOffset",n.__offset=e),h&&(n.__ns=h),n},sb=function(a,b){return rb(a,!1,b)},tb=function(a,b){return rb(a,!0,b)},ub=/^([+-])?P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)(?:\.(\d+))?S)?)?/,vb=function(a){var b=ub.exec(a);if(null===b)throw{message:"Invalid duration value."};var c=b[2]||"0",d=b[3]||"0",e=o(b[4]||0),f=o(b[5]||0),g=o(b[6]||0),h=parseFloat(b[7]||0);if("0"!==c||"0"!==d)throw{message:"Unsupported duration value."};var i=b[8],j=0;if(i){if(i.length>7)throw{message:"Cannot parse duration value to given precision."};j=Ia(i.substring(3),4,!0),i=Ia(i.substring(0,3),3,!0),i=o(i),j=o(j)}else i=0;i+=1e3*h+6e4*g+36e5*f+864e5*e,"-"===b[1]&&(i=-i);var k={ms:i,__edmType:"Edm.Time"};return j&&(k.ns=j),k},wb=function(a){var b=a.substring(0,1);return b="+"===b?1:-1,{d:b,h:o(a.substring(1)),m:o(a.substring(a.indexOf(":")+1))}},xb=function(a,b,c){a.method||(a.method="GET"),a.headers?ob(a.headers):a.headers={},void 0===a.headers.Accept&&(a.headers.Accept=b.accept),f(a.data)&&void 0===a.body&&b.write(a,c),f(a.headers.MaxDataServiceVersion)||(a.headers.MaxDataServiceVersion=b.maxDataServiceVersion||"1.0")},yb=function(a,b,c){if(a&&"object"==typeof a)for(var d in a){var e=a[d],f=yb(e,d,c);f=c(d,f,b),f!==e&&(void 0===e?delete a[d]:a[d]=f)}return a},zb=function(a,b){return b("",yb(a,"",b))},Ab=0,Bb=function(a){return!a.method||"GET"===a.method},Cb=function(b){var c=a.document.createElement("IFRAME");c.style.display="none";var d=b.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;"),e='<html><head><script type="text/javascript" src="'+d+'"><\/script></head><body></body></html>';return a.document.getElementsByTagName("BODY")[0].appendChild(c),Jb(c,e),c},Db=function(){if(a.XMLHttpRequest)return new a.XMLHttpRequest;var b;if(a.ActiveXObject)try{return new a.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(c){try{return new a.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(d){b=d}}else b={message:"XMLHttpRequest not supported"};throw b},Eb=function(a){return 0===a.indexOf("http://")||0===a.indexOf("https://")||0===a.indexOf("file://")},Fb=function(b){if(!Eb(b))return!0;var c=a.location,d=c.protocol+"//"+c.host+"/";return 0===b.indexOf(d)},Gb=function(b,c){try{delete a[b]}catch(d){a[b]=void 0,c===Ab-1&&(Ab-=1)}},Hb=function(a){return a&&(Jb(a,""),a.parentNode.removeChild(a)),null},Ib=function(a,b){var c,d,e=a.getAllResponseHeaders().split(/\r?\n/);for(c=0,d=e.length;c<d;c++)if(e[c]){var f=e[c].split(": ");b[f[0]]=f[1]}},Jb=function(a,b){var c=a.contentWindow?a.contentWindow.document:a.contentDocument.document;c.open(),c.write(b),c.close()};d.defaultHttpClient={callbackParameterName:"$callback",formatQueryString:"$format=json",enableJsonpCallback:!1,request:function(b,c,d){var e,f={},g=null,j=!1;f.abort=function(){e=Hb(e),j||(j=!0,g&&(g.abort(),g=null),d({message:"Request aborted"}))};var k,l=function(){e=Hb(e),j||(j=!0,g=null,d({message:"Request timed out"}))},m=b.requestUri,n=h(b.enableJsonpCallback,this.enableJsonpCallback),o=h(b.callbackParameterName,this.callbackParameterName),p=h(b.formatQueryString,this.formatQueryString);if(!n||Fb(m)){if(g=Db(),g.onreadystatechange=function(){if(!j&&null!==g&&4===g.readyState){var a=g.statusText,e=g.status;1223===e&&(e=204,a="No Content");var f=[];Ib(g,f);var h={requestUri:m,statusCode:e,statusText:a,headers:f,body:g.responseText};j=!0,g=null,e>=200&&e<=299?c(h):d({message:"HTTP request failed",request:b,response:h})}},g.open(b.method||"GET",m,!0,b.user,b.password),b.headers)for(k in b.headers)g.setRequestHeader(k,b.headers[k]);b.timeoutMS&&(g.timeout=b.timeoutMS,g.ontimeout=l),g.send(b.body)}else{if(!Bb(b))throw{message:"Request is not local and cannot be done through JSONP."};var q=Ab;Ab+=1;var r,s=q.toString(),t=!1;k="handleJSONP_"+s,a[k]=function(b){if(e=Hb(e),!j){t=!0,a.clearTimeout(r),Gb(k,q),a.ActiveXObject&&(b=a.JSON.parse(a.JSON.stringify(b)));var d;d=void 0===b.d?{"Content-Type":"application/json;odata=minimalmetadata",dataServiceVersion:"3.0"}:{"Content-Type":"application/json"},i(function(){Hb(e),c({body:b,statusCode:200,headers:d})})}};var u=b.timeoutMS?b.timeoutMS:12e4;r=a.setTimeout(l,u);var v=o+"=parent."+k;this.formatQueryString&&(v+="&"+p);var w=m.indexOf("?");-1===w?m=m+"?"+v:w===m.length-1?m+=v:m=m+"&"+v,e=Cb(m)}return f}};var Kb=function(a){if(!a)return null;var b,c,d=a.split(";"),e={};for(b=1,c=d.length;b<c;b++){var f=d[b].split("=");e[r(f[0])]=f[1]}return{mediaType:r(d[0]),properties:e}},Lb=function(a){if(a){var b,c=a.mediaType;for(b in a.properties)c+=";"+b+"="+a.properties[b];return c}},Mb=function(a,b,c,d){var e={};return j(e,c),j(e,{contentType:a,dataServiceVersion:b,handler:d}),e},Nb=function(a,b,c){if(a){var d=a.headers;d[b]||(d[b]=c)}},Ob=function(a,b){if(a){var c=a.headers,d=c.DataServiceVersion;c.DataServiceVersion=d?mb(d,b):b}},Pb=function(a,b){var c=a.headers;return c&&c[b]||void 0},Qb=function(a){return Kb(Pb(a,"Content-Type"))},Rb=/^\s?(\d+\.\d+);?.*$/,Sb=function(a){var b=Pb(a,"DataServiceVersion");if(b){var c=Rb.exec(b);if(c&&c.length)return c[1]}},Tb=function(a,b){return a.accept.indexOf(b.mediaType)>=0},Ub=function(a,b,c,d){if(!c||!c.headers)return!1;var e=Qb(c),g=Sb(c)||"",h=c.body;if(!f(h))return!1;if(Tb(a,e)){var i=Mb(e,g,d,a);return i.response=c,c.data=b(a,h,i),void 0!==c.data}return!1},Vb=function(a,b,c,d){if(!c||!c.headers)return!1;var e=Qb(c),f=Sb(c);if(!e||Tb(a,e)){var g=Mb(e,f,d,a);if(g.request=c,c.body=b(a,c.data,g),void 0!==c.body)return Ob(c,g.dataServiceVersion||"1.0"),Nb(c,"Content-Type",Lb(g.contentType)),Nb(c,"MaxDataServiceVersion",a.maxDataServiceVersion),!0}return!1},Wb=function(a,b,c,d){return{accept:c,maxDataServiceVersion:d,read:function(b,c){return Ub(this,a,b,c)},write:function(a,c){return Vb(this,b,a,c)}}},Xb=function(a,b){return b},Yb=function(a,b){return f(b)?b.toString():void 0};d.textHandler=Wb(Xb,Yb,"text/plain","3.0");var Zb="http://www.opengis.net/gml",$b="http://www.opengis.net/def/crs/EPSG/0/",_b=function(a,b,c){var d={type:a};return d[b]=c,d},ac=function(a){if(l(a)&&a.length>=2){var b=a[0];a[0]=a[1],a[1]=b}return a},bc=function(a,b,c,d,e,f){var g=cc(a,c,d,e,f);return _b(b,"coordinates",g)},cc=function(a,b,c,d,e){var f=[];return aa(a,function(a){if(ia(a)===Zb){var g=ha(a);if(g!==b)g===c&&aa(a,function(a){if(ia(a)===Zb){var b=d(a,e);b&&f.push(b)}});else{var h=da(a,Zb);if(h){var i=d(h,e);i&&f.push(i)}}}}),f},dc=function(a,b){var c=cc(a,"geometryMember","geometryMembers",rc,b);return _b("GeometryCollection","geometries",c)},ec=function(a,b){return _b("LineString","coordinates",kc(a,b))},fc=function(a,b){return bc(a,"MultiLineString","curveMember","curveMembers",kc,b)},gc=function(a,b){return bc(a,"MultiPoint","pointMember","pointMembers",lc,b)},hc=function(a,b){return bc(a,"MultiPolygon","surfaceMember","surfaceMembers",nc,b)},ic=function(a,b){return _b("Point","coordinates",lc(a,b))},jc=function(a,b){return _b("Polygon","coordinates",nc(a,b))},kc=function(a,b){var c=[];return aa(a,function(a){if(ia(a)===Zb){var d=ha(a);return"posList"===d?void(c=pc(a,b)):"pointProperty"===d?void c.push(mc(a,b)):"pos"===d?void c.push(qc(a,b)):void 0}}),c},lc=function(a,b){var c=da(a,Zb,"pos");return c?qc(c,b):[]},mc=function(a,b){var c=da(a,Zb,"Point");return c?lc(c,b):[]},nc=function(a,b){var c=[],d=!1;return aa(a,function(a){if(ia(a)===Zb){var e=ha(a);return"exterior"===e?(d=!0,void c.unshift(oc(a,b))):"interior"===e?void c.push(oc(a,b)):void 0}}),!d&&c.length>0&&c.unshift([[]]),c},oc=function(a,b){var c=[];return aa(a,function(a){ia(a)===Zb&&"LinearRing"===ha(a)&&(c=kc(a,b))}),c},pc=function(a,b){var c=qc(a,!1),d=c.length;if(d%2!=0)throw{message:"GML posList element has an uneven number of numeric values"};for(var e=[],f=0;f<d;f+=2){var g=c.slice(f,f+2);e.push(b?ac(g):g)}return e},qc=function(a,b){var c=[],d=ga(a);if(d)for(var e=d.length,f=0,g=0;g<=e;){if(-1!==" \t\r\n".indexOf(d.charAt(g))){var h=d.substring(f,g);h&&c.push(parseFloat(h)),f=g+1}g++}return b?ac(c):c},rc=function(a,b){var c,d=ha(a);switch(d){case"Point":c=ic;break;case"Polygon":c=jc;break;case"LineString":c=ec;break;case"MultiPoint":c=gc;break;case"MultiCurve":c=fc;break;case"MultiSurface":c=hc;break;case"MultiGeometry":c=dc;break;default:throw{message:"Unsupported element: "+d,element:a}}var e=c(a,b),f=Z(a,"srsName",Zb)||Z(a,"srsName");if(f){if(0!==f.indexOf($b))throw{message:"Unsupported srs name: "+f,element:a};var g=f.substring($b.length);g&&(e.crs={type:"name",properties:{name:"EPSG:"+g}})}return e},sc=function(a,b,c,d){var e;switch(c){case"Point":e=Ac;break;case"LineString":e=Bc;break;case"Polygon":e=Cc;break;case"MultiPoint":e=Ec;break;case"MultiLineString":e=Fc;break;case"MultiPolygon":e=Gc;break;case"GeometryCollection":e=Ic;break;default:return null}var f=e(a,b,d),g=b.crs;if(g&&"name"===g.type){var h=g.properties,i=h&&h.name;if(i&&0===i.indexOf("ESPG:")&&i.length>5){var j=i.substring(5),k=pa(a,null,"srsName","gml"+j);oa(f,k)}}return f},tc=function(a,b,c){return qa(a,Zb,W("gml",b),c)},uc=function(a,b,c){var d=l(b)?b:[];return d=c?ac(d):d,tc(a,"pos",d.join(" "))},vc=function(a,b,c,d){var e=tc(a,b);if(l(c)){var f,g;for(f=0,g=c.length;f<g;f++)oa(e,uc(a,c[f],d));0===g&&oa(e,tc(a,"posList"))}return e},wc=function(a,b,c){return tc(a,"Point",uc(a,b,c))},xc=function(a,b,c){return vc(a,"LineString",b,c)},yc=function(a,b,c,d){var e=tc(a,b);if(l(c)&&c.length>0){var f=vc(a,"LinearRing",c,d);oa(e,f)}return e},zc=function(a,b,c){var d=b&&b.length,e=tc(a,"Polygon");if(l(b)&&d>0){oa(e,yc(a,"exterior",b[0],c));var f;for(f=1;f<d;f++)oa(e,yc(a,"interior",b[f],c))}return e},Ac=function(a,b,c){return wc(a,b.coordinates,c)},Bc=function(a,b,c){return xc(a,b.coordinates,c)},Cc=function(a,b,c){return zc(a,b.coordinates,c)},Dc=function(a,b,c,d,e,f){var g=d&&d.length,h=tc(a,b);if(l(d)&&g>0){var i,j=tc(a,c);for(i=0;i<g;i++)oa(j,e(a,d[i],f));oa(h,j)}return h},Ec=function(a,b,c){return Dc(a,"MultiPoint","pointMembers",b.coordinates,wc,c)},Fc=function(a,b,c){return Dc(a,"MultiCurve","curveMembers",b.coordinates,xc,c)},Gc=function(a,b,c){return Dc(a,"MultiSurface","surfaceMembers",b.coordinates,zc,c)},Hc=function(a,b,c){return sc(a,b,b.type,c)},Ic=function(a,b,c){return Dc(a,"MultiGeometry","geometryMembers",b.geometries,Hc,c)},Jc=H+"schemas.microsoft.com/ado/",Kc=Jc+"2007/08/dataservices",Lc=Jc+"2007/06/edmx",Mc=Kc,Nc=Kc+"/metadata",Oc=Kc+"/related/",Pc=Kc+"/scheme",Qc=function(a,b){var c={name:ha(a),value:a.value};return c[b?"namespaceURI":"namespace"]=ia(a),c},Rc=function(a,b){var c,d,e=[],f=[],g=a.attributes;for(c=0,d=g.length;c<d;c++){var h=g[c];ia(h)!==K&&e.push(Qc(h,b))}for(var i=a.firstChild;null!=i;)1===i.nodeType&&f.push(Rc(i,b)),i=i.nextSibling;var j={name:ha(a),value:ga(a),attributes:e,children:f};return j[b?"namespaceURI":"namespace"]=ia(a),j},Sc=function(a){return ia(a)===Mc&&"element"===ha(a)},Tc=function(a,b){return{type:a,extensions:b}},Uc=function(a){if(da(a,Zb))return"Edm.Geometry";var b=da(a,Mc);if(!b)return"Edm.String";if(Sc(b)){var c=la(b,Mc);if(c&&Sc(c))return"Collection()"}return null},Vc=function(a){var b=null,c=!1,d=[];return Y(a,function(a){var e=ia(a),f=ha(a),g=ja(a);if(e===Nc){if("null"===f)return void(c="true"===g.toLowerCase());if("type"===f)return void(b=g)}if(e!==L&&e!==K)return void d.push(Qc(a,!0))}),{type:!b&&c?"Edm.String":b,isNull:c,extensions:d}},Wc=function(a){if(ia(a)!==Mc)return null;var b=ha(a),c=Vc(a),d=c.isNull,e=c.type,f=Tc(e,c.extensions);return{name:b,value:d?null:Xc(a,e,f),metadata:f}},Xc=function(a,b,c){b||(b=Uc(a),c.type=b);var d=Va(b);return d||Wa(b)?Yc(a,b,d):Za(b)?Zc(a,b):Pa(b)?_c(a,b,c):$c(a,b,c)},Yc=function(a,b,c){var d=da(a,Zb),e=rc(d,c);return e.__metadata={type:b},e},Zc=function(a,b){var c=ja(a)||"";switch(b){case"Edm.Boolean":return pb(c);case"Edm.Binary":case"Edm.Decimal":case"Edm.Guid":case"Edm.Int64":case"Edm.String":return c;case"Edm.Byte":case"Edm.Int16":case"Edm.Int32":case"Edm.SByte":return o(c);case"Edm.Double":case"Edm.Single":return parseFloat(c);case"Edm.Time":return vb(c);case"Edm.DateTime":return sb(c);case"Edm.DateTimeOffset":return tb(c)}return c},$c=function(a,b,c){var d={__metadata:{type:b}};return aa(a,function(a){var b=Wc(a),e=b.name;c.properties=c.properties||{},c.properties[e]=b.metadata,d[e]=b.value}),d},_c=function(a,b,c){var d=[],e=c.elements=[],f=Ka(b);return aa(a,function(a){if(Sc(a)){var b=Vc(a),c=b.extensions,g=b.type||f,h=Tc(g,c),i=Xc(a,g,h);d.push(i),e.push(h)}}),{__metadata:{type:"Collection()"===b?null:b},results:d}},ad=function(a,b){if(ia(a)===Mc){b=_(a,b);var c=ha(a);if("links"===c)return bd(a,b);if("uri"===c)return cd(a,b)}},bd=function(a,b){var c=[];return aa(a,function(a){"uri"===ha(a)&&ia(a)===Mc&&c.push(cd(a,b))}),{results:c}},cd=function(a,b){var c=ga(a)||"";return{uri:A(c,b)}},dd=function(a,b){return"Edm.Geometry"===b||"Edm.Geography"===b?a&&a.type:"Edm.GeometryPoint"===b||"Edm.GeographyPoint"===b?"Point":"Edm.GeometryLineString"===b||"Edm.GeographyLineString"===b?"LineString":"Edm.GeometryPolygon"===b||"Edm.GeographyPolygon"===b?"Polygon":"Edm.GeometryCollection"===b||"Edm.GeographyCollection"===b?"GeometryCollection":"Edm.GeometryMultiPolygon"===b||"Edm.GeographyMultiPolygon"===b?"MultiPolygon":"Edm.GeometryMultiLineString"===b||"Edm.GeographyMultiLineString"===b?"MultiLineString":"Edm.GeometryMultiPoint"===b||"Edm.GeographyMultiPoint"===b?"MultiPoint":null},ed=function(a,b,c){return qa(a,Nc,W("m",b),c)},fd=function(a,b,c){return pa(a,Nc,W("m",b),c)},gd=function(a,b,c){return qa(a,Mc,W("d",b),c)},hd=function(a,b){return"Edm.DateTime"===b||"Edm.DateTimeOffset"===b||m(a)?Ga(a):"Edm.Time"===b?Ha(a):a.toString()},id=function(a,b){return{element:a,dsv:b}},jd=function(a,b,c,d){var e=c?fd(a,"type",c):null,f=gd(a,b,e);return na(f,d)},kd=function(a,b,c,d){var e=hd(c,d),f=jd(a,b,d,e);return id(f,"1.0")},ld=function(a,b,c,d){var e=fd(a,"null","true"),f=jd(a,b,c,e),g=cb(c,d)?"2.0":"1.0";return id(f,g)},md=function(a,b,c,d,e,f,g){var h=Ka(d),i=l(c)?c:c.results,j=d?{type:h}:{};j.properties=e.properties;var k,m,n=jd(a,b,h?d:null);for(k=0,m=i.length;k<m;k++){var o=i[k],p=pd(a,"element",o,j,f,g);oa(n,p.element)}return id(n,"3.0")},nd=function(a,b,c,d,e,f,g){var h=jd(a,b,d),i=e.properties||{},j=cb(d,g)||{},k="1.0";for(var l in c)if("__metadata"!==l){var m=c[l],n=_a(j.property,l),o=i[l]||{},p=pd(a,l,m,o,n,g);k=mb(k,p.dsv),oa(h,p.element)}return id(h,k)},od=function(a,b,c,d,e){var f=dd(c,d),g=sc(a,c,f,e),h=jd(a,b,d,g);return id(h,"3.0")},pd=function(a,b,c,d,e,f){var g=Aa(c,d);if(Ya(c))return kd(a,b,c,g||"Edm.String");var h=Va(g);return h||Wa(g)?od(a,b,c,g,h):Oa(c,g)?md(a,b,c,g,d,e,f):Xa(c)?null:null!==$a(c,e)?null:null===c?ld(a,b,g):nd(a,b,c,g,d,0,f)},qd=function(a){if(a&&n(a)){var b=ma();return oa(b,gd(b,"uri",a.uri))}},rd=function(a,b){if(b){var c=V(b),d=da(c);if(d)return ad(d)}},sd=function(a,b,c){var d=c.contentType=c.contentType||Kb("application/xml");if(d&&"application/xml"===d.mediaType)return va(qd(b))};d.xmlHandler=Wb(rd,sd,"application/xml","3.0");var td=I+"2005/Atom",ud=I+"2007/app",vd=Kc+"/edit-media/",wd=["application/atom+xml","application/atomsvc+xml","application/xml"],xd=wd[0],yd=[td,ud,L,K],zd={SyndicationAuthorEmail:"author/email",SyndicationAuthorName:"author/name",SyndicationAuthorUri:"author/uri",SyndicationContributorEmail:"contributor/email",SyndicationContributorName:"contributor/name",SyndicationContributorUri:"contributor/uri",SyndicationPublished:"published",SyndicationRights:"rights",SyndicationSummary:"summary",SyndicationTitle:"title",SyndicationUpdated:"updated"},Ad=function(a){return zd[a]||a},Bd=function(a){return!g(yd,a)},Cd=function(a,b,c,d,e){e=e||"";var f=a["FC_TargetPath"+e];if(!f)return null;var g=a["FC_SourcePath"+e],h=Ad(f),i=d?d+(g?"/"+g:""):g,j=i&&Qd(c,b,i),k=a["FC_NsUri"+e]||null,l=a["FC_NsPrefix"+e]||null,m=a["FC_KeepInContent"+e]||"";return f!==h&&(k=td,l="a"),{contentKind:a["FC_ContentKind"+e],keepInContent:"true"===m.toLowerCase(),nsPrefix:l,nsURI:k,propertyPath:i,propertyType:j,entryPath:h}},Dd=function(a,b,c){for(var d=[];a;){var e=(a.FC_SourcePath,Cd(a,a,b));e&&c(e);var f,g,h=a.property||[];for(f=0,g=h.length;f<g;f++)for(var i=h[f],j=0,k="";e=Cd(i,a,b,i.name,k);)c(e),j++,k="_"+j;a=db(a.baseType,b)}return d},Ed=function(a){var b=[];return Y(a,function(a){var c=ia(a);Bd(c)&&b.push(Qc(a,!0))}),b},Fd=function(a){return Rc(a,!0)},Gd=function(a,b,c){var d=ia(a),e=ha(a);if(d===ud&&"service"===e)return be(a,b);if(d===td){if("feed"===e)return Kd(a,b,c);if("entry"===e)return Rd(a,b,c)}},Hd=function(a,b){var c=[],d={extensions:c};return Y(a,function(e){var f=ha(e),g=ia(e),h=ja(e);if(null===g){if("title"===f||"metadata"===f)return void(d[f]=h);if("target"===f)return void(d.target=A(h,_(a,b)))}Bd(g)&&c.push(Qc(e,!0))}),d},Id=function(a,b,c){(c.actions=c.actions||[]).push(Hd(a,b))},Jd=function(a,b,c){
(c.functions=c.functions||[]).push(Hd(a,b))},Kd=function(a,b,c){var d=Ed(a),e={feed_extensions:d},f=[],g={__metadata:e,results:f};return b=_(a,b),aa(a,function(a){var h=ia(a),i=ha(a);if(h===Nc){if("count"===i)return void(g.__count=parseInt(ga(a),10));if("action"===i)return void Id(a,b,e);if("function"===i)return void Jd(a,b,e)}return Bd(h)?void d.push(Rc(a)):"entry"===i?void f.push(Rd(a,b,c)):"link"===i?void Ld(a,g,b):"id"===i?(e.uri=A(ga(a),b),void(e.uri_extensions=Ed(a))):"title"===i?(e.title=ga(a)||"",void(e.title_extensions=Ed(a))):void 0}),g},Ld=function(a,b,c){var d=Md(a,c),e=d.href,f=d.rel,g=d.extensions,h=b.__metadata;return"next"===f?(b.__next=e,void(h.next_extensions=g)):"self"===f?(h.self=e,void(h.self_extensions=g)):void 0},Md=function(a,b){b=_(a,b);var c=[],d={extensions:c,baseURI:b};if(Y(a,function(a){var e=ia(a),f=ha(a),g=a.value;return"href"===f?void(d.href=A(g,b)):"type"===f||"rel"===f?void(d[f]=g):void(Bd(e)&&c.push(Qc(a,!0)))}),!d.href)throw{error:"href attribute missing on link element",element:a};return d},Nd=function(a,b){if(-1===a.indexOf("/"))return b[a];var c,d,e=a.split("/");for(c=0,d=e.length;c<d;c++){if(null===b)return;if(void 0===(b=b[e[c]]))return b}return b},Od=function(a,b,c,d){var e;if(-1===a.indexOf("/"))b[a]=c,e=a;else{var f,g,h=a.split("/");for(f=0,g=h.length-1;f<g;f++){var i=b[h[f]];if(void 0===i)i={},b[h[f]]=i;else if(null===i)return;b=i}e=h[f],b[e]=c}if(d){var j=b.__metadata=b.__metadata||{},k=j.properties=j.properties||{};(k[e]=k[e]||{}).type=d}},Pd=function(a,b,c){var d=a.propertyPath;if(!a.keepInContent&&null!==Nd(d,c)){var e=ca(b,a.nsURI,a.entryPath);if(e){var f,g=a.propertyType;f="xhtml"===a.contentKind?wa(e):Zc(e,g||"Edm.String"),Od(d,c,f,g)}}},Qd=function(a,b,c){for(var d,e,f=c.split("/");b;){var g=b;for(d=0,e=f.length;d<e;d++){var h=g.property;if(!h)break;var i=_a(h,f[d]);if(!i)break;var j=i.type;if(!j||Za(j))return j||null;if(!(g=cb(j,a)))return null}b=db(b.baseType,a)}return null},Rd=function(a,b,c){var d={},e={__metadata:d},f=Z(a,"etag",Nc);f&&(d.etag=f),b=_(a,b),aa(a,function(a){var f=ia(a),g=ha(a);if(f!==td){if(f===Nc){if("properties"===g)return void ae(a,e,d);if("action"===g)return void Id(a,b,d);if("function"===g)return void Jd(a,b,d)}}else{if("id"===g)return void Sd(a,d,b);if("category"===g)return void Td(a,d);if("content"===g)return void Ud(a,e,d,b);if("link"===g)return void Vd(a,e,d,b,c)}});var g=db(d.type,c);return Dd(g,c,function(b){Pd(b,a,e)}),e},Sd=function(a,b,c){b.uri=A(ga(a),_(a,c)),b.uri_extensions=Ed(a)},Td=function(a,b){if(Z(a,"scheme")===Pc){if(b.type)throw{message:"Invalid AtomPub document: multiple category elements defining the entry type were encounterd withing an entry",element:a};var c=[];Y(a,function(a){var b=ia(a),d=ha(a);if(!b)return void("scheme"!==d&&"term"!==d&&c.push(Qc(a,!0)));Bd(b)&&c.push(Qc(a,!0))}),b.type=Z(a,"term"),b.type_extensions=c}},Ud=function(a,b,c,d){var e=Z(a,"src"),f=Z(a,"type");if(e){if(!f)throw{message:"Invalid AtomPub document: content element must specify the type attribute if the src attribute is also specified",element:a};c.media_src=A(e,_(a,d)),c.content_type=f}aa(a,function(d){if(e)throw{message:"Invalid AtomPub document: content element must not have child elements if the src attribute is specified",element:a};ia(d)===Nc&&"properties"===ha(d)&&ae(d,b,c)})},Vd=function(a,b,c,d,e){var f=Md(a,d),g=f.rel,h=f.href,i=f.extensions;return"self"===g?(c.self=h,void(c.self_link_extensions=i)):"edit"===g?(c.edit=h,void(c.edit_link_extensions=i)):"edit-media"===g?(c.edit_media=f.href,c.edit_media_extensions=i,void _d(f,c)):0===g.indexOf(vd)?void Yd(f,b,c):0===g.indexOf("http://schemas.microsoft.com/ado/2007/08/dataservices/mediaresource/")?void Zd(f,b,c):0===g.indexOf(Oc)?void Xd(a,f,b,c,e):0===g.indexOf("http://schemas.microsoft.com/ado/2007/08/dataservices/relatedlinks/")?void Wd(f,c):void 0},Wd=function(a,b){var c=a.rel.substring("http://schemas.microsoft.com/ado/2007/08/dataservices/relatedlinks/".length);b.properties=b.properties||{};var d=b.properties[c]=b.properties[c]||{};d.associationuri=a.href,d.associationuri_extensions=a.extensions},Xd=function(a,b,c,d,e){var f,g=da(a,Nc,"inline");if(g){var h=da(g),i=_(g,b.baseURI);f=h?Gd(h,i,e):null}else f={__deferred:{uri:b.href}};var j=b.rel.substring(Oc.length);c[j]=f,d.properties=d.properties||{},(d.properties[j]=d.properties[j]||{}).extensions=b.extensions},Yd=function(a,b,c){var d=a.rel.substring(vd.length),e=$d(d,b,c),f=e.value,g=e.metadata,h=a.href;f.edit_media=h,f.content_type=a.type,g.edit_media_extensions=a.extensions,f.media_src=f.media_src||h,g.media_src_extensions=g.media_src_extensions||[],_d(a,f)},Zd=function(a,b,c){var d=a.rel.substring("http://schemas.microsoft.com/ado/2007/08/dataservices/mediaresource/".length),e=$d(d,b,c),f=e.value,g=e.metadata;f.media_src=a.href,g.media_src_extensions=a.extensions,f.content_type=a.type},$d=function(a,b,c){c.properties=c.properties||{};var d=c.properties[a],e=b[a]&&b[a].__mediaresource;return e||(e={},b[a]={__mediaresource:e},c.properties[a]=d={}),{value:e,metadata:d}},_d=function(a,b){var c,d,e=a.extensions;for(c=0,d=e.length;c<d;c++)if(e[c].namespaceURI===Nc&&"etag"===e[c].name)return b.media_etag=e[c].value,void e.splice(c,1)},ae=function(a,b,c){aa(a,function(a){var d=Wc(a);if(d){var e=d.name;(c.properties=c.properties||{})[e]=d.metadata,b[e]=d.value}})},be=function(a,b){var c=[],d=[];if(b=_(a,b),aa(a,function(a){if(ia(a)===ud&&"workspace"===ha(a))return void c.push(ce(a,b));d.push(Rc(a))}),0===c.length)throw{message:"Invalid AtomPub service document: No workspace element found.",element:a};return{workspaces:c,extensions:d}},ce=function(a,b){var c,d=[],e=[];return b=_(a,b),aa(a,function(a){var f=ia(a),g=ha(a);if(f===td&&"title"===g){if(void 0!==c)throw{message:"Invalid AtomPub service document: workspace has more than one child title element",element:a};return void(c=ga(a))}if(f===ud)return void("collection"===g&&d.push(de(a,b)));e.push(Fd(a))}),{title:c||"",collections:d,extensions:e}},de=function(a,b){var c=Z(a,"href");if(!c)throw{message:"Invalid AtomPub service document: collection has no href attribute",element:a};b=_(a,b),c=A(c,_(a,b));var d,e=[];if(aa(a,function(b){var c=ia(b),f=ha(b);if(c!==td)c!==ud&&e.push(Fd(a));else if("title"===f){if(void 0!==d)throw{message:"Invalid AtomPub service document: collection has more than one child title element",element:b};d=ga(b)}}),!d)throw{message:"Invalid AtomPub service document: collection has no title element",element:a};return{title:d,href:c,extensions:e}},ee=function(a,b,c){return qa(a,td,W("a",b),c)},fe=function(a,b,c){return pa(a,null,b,c)},ge=function(a){if(a.childNodes.length>0)return!1;var b,c,d=!0,e=a.attributes;for(b=0,c=e.length;b<c&&d;b++){var f=e[b];d=d&&P(f)||ia(f)==Nc&&"type"===ha(f)}return d},he=function(a,b,c,d,e){var f=null,g=null,h=null,i="";"deferred"!==c?(f=fe(a,"type","application/atom+xml;type="+c),g=ed(a,"inline"),d&&(i=d.__metadata&&d.__metadata.uri||"",h=le(a,d,e)||ke(a,d,e),oa(g,h.element))):i=d.__deferred.uri;var j=ee(a,"link",[fe(a,"href",i),fe(a,"rel",A(b,Oc)),f,g]);return id(j,h?h.dsv:"1.0")},ie=function(a,b,c,d,e,f){if(Xa(c))return null;var g=pd(a,b,c,d,e,f);if(!g){var h=$a(c,e);g=he(a,b,h,c,f)}return g},je=function(a,b,c,d){var e,f=ba(c,Mc,d.propertyPath),g=f&&$(f,"null",Nc),h="1.0";if(g&&"true"===g.value)return h;if(f&&(e=ga(f)||"",!d.keepInContent)){h="2.0";var i=f.parentNode,j=i;for(i.removeChild(f);j!==c&&ge(j);)i=j.parentNode,i.removeChild(j),j=i}var k=ua(a,b,d.nsURI,d.nsPrefix,d.entryPath);if(2===k.nodeType)return k.value=e,h;var l=d.contentKind;return na(k,[l&&pa(a,null,"type",l),"xhtml"===l?sa(a,e):e]),h},ke=function(a,b,c){var d=b.__metadata||{},e=d.properties||{},f=d.etag,g=d.uri,h=d.type,i=db(h,c),j=ed(a,"properties"),k=ee(a,"entry",[ee(a,"author",ee(a,"name")),f&&fd(a,"etag",f),g&&ee(a,"id",g),h&&ee(a,"category",[fe(a,"term",h),fe(a,"scheme",Pc)]),ee(a,"content",[fe(a,"type","application/xml"),j])]),l="1.0";for(var m in b)if("__metadata"!==m){var n=e[m]||{},o=i&&(_a(i.property,m)||_a(i.navigationProperty,m)),p=ie(a,m,b[m],n,o,c);if(p){var q=p.element,r=ia(q)===td?k:j;oa(r,q),l=mb(l,p.dsv)}}return Dd(i,c,function(b){var c=je(a,k,j,b);l=mb(l,c)}),id(k,l)},le=function(a,b,c){var d=l(b)?b:b.results;if(!d)return null;var e,f,g="1.0",h=ee(a,"feed");for(e=0,f=d.length;e<f;e++){var i=ke(a,d[e],c);oa(h,i.element),g=mb(g,i.dsv)}return id(h,g)},me=function(a,b){if(a){var c=Ua(a)&&le||n(a)&&ke;if(c){var d=ma(),e=c(d,a,b);if(e){var f=e.element;return na(f,[ra(d,Nc,"m"),ra(d,Mc,"d")]),id(oa(d,f),e.dsv)}}}return null},ne=function(a,b,c){if(b){var d=V(b),e=da(d);if(e)return Gd(e,null,c.metadata)}},oe=function(a,b,c){var d=c.contentType=c.contentType||Kb(xd);if(d&&d.mediaType===xd){var e=me(b,c.metadata);if(e)return c.dataServiceVersion=mb(c.dataServiceVersion||"1.0",e.dsv),va(e.element)}};d.atomHandler=Wb(ne,oe,wd.join(","),"3.0");var pe=function(a,b,c,d){return{attributes:a,elements:b,text:c||!1,ns:d}},qe={elements:{Annotations:pe(["Target","Qualifier"],["TypeAnnotation*","ValueAnnotation*"]),Association:pe(["Name"],["End*","ReferentialConstraint","TypeAnnotation*","ValueAnnotation*"]),AssociationSet:pe(["Name","Association"],["End*","TypeAnnotation*","ValueAnnotation*"]),Binary:pe(null,null,!0),Bool:pe(null,null,!0),Collection:pe(null,["String*","Int*","Float*","Decimal*","Bool*","DateTime*","DateTimeOffset*","Guid*","Binary*","Time*","Collection*","Record*"]),CollectionType:pe(["ElementType","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"],["CollectionType","ReferenceType","RowType","TypeRef"]),ComplexType:pe(["Name","BaseType","Abstract"],["Property*","TypeAnnotation*","ValueAnnotation*"]),DateTime:pe(null,null,!0),DateTimeOffset:pe(null,null,!0),Decimal:pe(null,null,!0),DefiningExpression:pe(null,null,!0),Dependent:pe(["Role"],["PropertyRef*"]),Documentation:pe(null,null,!0),End:pe(["Type","Role","Multiplicity","EntitySet"],["OnDelete"]),EntityContainer:pe(["Name","Extends"],["EntitySet*","AssociationSet*","FunctionImport*","TypeAnnotation*","ValueAnnotation*"]),EntitySet:pe(["Name","EntityType"],["TypeAnnotation*","ValueAnnotation*"]),EntityType:pe(["Name","BaseType","Abstract","OpenType"],["Key","Property*","NavigationProperty*","TypeAnnotation*","ValueAnnotation*"]),EnumType:pe(["Name","UnderlyingType","IsFlags"],["Member*"]),Float:pe(null,null,!0),Function:pe(["Name","ReturnType"],["Parameter*","DefiningExpression","ReturnType","TypeAnnotation*","ValueAnnotation*"]),FunctionImport:pe(["Name","ReturnType","EntitySet","IsSideEffecting","IsComposable","IsBindable","EntitySetPath"],["Parameter*","ReturnType","TypeAnnotation*","ValueAnnotation*"]),Guid:pe(null,null,!0),Int:pe(null,null,!0),Key:pe(null,["PropertyRef*"]),LabeledElement:pe(["Name"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),Member:pe(["Name","Value"]),NavigationProperty:pe(["Name","Relationship","ToRole","FromRole","ContainsTarget"],["TypeAnnotation*","ValueAnnotation*"]),Null:pe(null,null),OnDelete:pe(["Action"]),Path:pe(null,null,!0),Parameter:pe(["Name","Type","Mode","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","SRID"],["CollectionType","ReferenceType","RowType","TypeRef","TypeAnnotation*","ValueAnnotation*"]),Principal:pe(["Role"],["PropertyRef*"]),Property:pe(["Name","Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","CollectionKind","SRID"],["CollectionType","ReferenceType","RowType","TypeAnnotation*","ValueAnnotation*"]),PropertyRef:pe(["Name"]),PropertyValue:pe(["Property","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ReferenceType:pe(["Type"]),ReferentialConstraint:pe(null,["Principal","Dependent"]),ReturnType:pe(["ReturnType","Type","EntitySet"],["CollectionType","ReferenceType","RowType"]),RowType:pe(["Property*"]),String:pe(null,null,!0),Schema:pe(["Namespace","Alias"],["Using*","EntityContainer*","EntityType*","Association*","ComplexType*","Function*","ValueTerm*","Annotations*"]),Time:pe(null,null,!0),TypeAnnotation:pe(["Term","Qualifier"],["PropertyValue*"]),TypeRef:pe(["Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"]),Using:pe(["Namespace","Alias"]),ValueAnnotation:pe(["Term","Qualifier","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ValueTerm:pe(["Name","Type"],["TypeAnnotation*","ValueAnnotation*"]),Edmx:pe(["Version"],["DataServices","Reference*","AnnotationsReference*"],!1,Lc),DataServices:pe(null,["Schema*"],!1,Lc)}},re=["m:FC_ContentKind","m:FC_KeepInContent","m:FC_NsPrefix","m:FC_NsUri","m:FC_SourcePath","m:FC_TargetPath"];qe.elements.Property.attributes=qe.elements.Property.attributes.concat(re),qe.elements.EntityType.attributes=qe.elements.EntityType.attributes.concat(re),qe.elements.Edmx={attributes:["Version"],elements:["DataServices"],ns:Lc},qe.elements.DataServices={elements:["Schema*"],ns:Lc},qe.elements.EntityContainer.attributes.push("m:IsDefaultEntityContainer"),qe.elements.Property.attributes.push("m:MimeType"),qe.elements.FunctionImport.attributes.push("m:HttpMethod"),qe.elements.FunctionImport.attributes.push("m:IsAlwaysBindable"),qe.elements.EntityType.attributes.push("m:HasStream"),qe.elements.DataServices.attributes=["m:DataServiceVersion","m:MaxDataServiceVersion"];var se=function(a){if(!a)return a;if(a.length>1){var b=a.substr(0,2);return b===b.toUpperCase()?a:a.charAt(0).toLowerCase()+a.substr(1)}return a.charAt(0).toLowerCase()},te=function(a,b){if("Documentation"===b)return{isArray:!0,propertyName:"documentation"};var c=a.elements;if(!c)return null;var d,e;for(d=0,e=c.length;d<e;d++){var f=c[d],g=!1;if("*"===f.charAt(f.length-1)&&(g=!0,f=f.substr(0,f.length-1)),b===f){return{isArray:g,propertyName:se(f)}}}return null},ue=/^(m:FC_.*)_[0-9]+$/,ve=function(a){return"http://schemas.microsoft.com/ado/2006/04/edm"===a||"http://schemas.microsoft.com/ado/2007/05/edm"===a||"http://schemas.microsoft.com/ado/2008/01/edm"===a||"http://schemas.microsoft.com/ado/2008/09/edm"===a||"http://schemas.microsoft.com/ado/2009/08/edm"===a||"http://schemas.microsoft.com/ado/2009/11/edm"===a},we=function(a){var b=ha(a),c=ia(a),d=qe.elements[b];if(!d)return null;if(d.ns){if(c!==d.ns)return null}else if(!ve(c))return null;var e={},f=[],h=d.attributes||[];return Y(a,function(a){var b=ha(a),c=ia(a),d=a.value;if(c!==K){var i=null,j=!1;if(ve(c)||null===c?i="":c===Nc&&(i="m:"),null!==i){i+=b;var k=ue.exec(i);k&&(i=k[1]),g(h,i)&&(j=!0,e[se(b)]=d)}j||f.push(Qc(a))}}),aa(a,function(a){var b=ha(a),c=te(d,b);if(c)if(c.isArray){var g=e[c.propertyName];g||(g=[],e[c.propertyName]=g),g.push(we(a))}else e[c.propertyName]=we(a);else f.push(Rc(a))}),d.text&&(e.text=ga(a)),f.length&&(e.extensions=f),e},xe=function(a,b){var c=V(b),d=da(c);return we(d)||void 0};d.metadataHandler=Wb(xe,null,"application/xml","3.0");var ye={readLink:"self",editLink:"edit",nextLink:"__next",mediaReadLink:"media_src",mediaEditLink:"edit_media",mediaContentType:"content_type",mediaETag:"media_etag",count:"__count",media_src:"mediaReadLink",edit_media:"mediaEditLink",content_type:"mediaContentType",media_etag:"mediaETag",url:"uri"},ze={metadata:"odata.metadata",count:"odata.count",next:"odata.nextLink",id:"odata.id",etag:"odata.etag",read:"odata.readLink",edit:"odata.editLink",mediaRead:"odata.mediaReadLink",mediaEdit:"odata.mediaEditLink",mediaEtag:"odata.mediaETag",mediaContentType:"odata.mediaContentType",actions:"odata.actions",functions:"odata.functions",navigationUrl:"odata.navigationLinkUrl",associationUrl:"odata.associationLinkUrl",type:"odata.type"},Ae=function(a){if(a.indexOf(".")>0){var b=a.indexOf("@"),c=b>-1?a.substring(0,b):null,d=a.substring(b+1);return{target:c,name:d,isOData:0===d.indexOf("odata.")}}return null},Be=function(a,b,c,d,e){return Qa(b)&&b["odata.type"]||c&&c[a+"@odata.type"]||d&&d.type||hb(d,e)||null},Ce=function(a,b){return b?_a(b.property,a)||_a(b.navigationProperty,a):null},De=function(a){return Qa(a)&&"odata.id"in a},Ee=function(a,b,c){if(b[a+"@odata.navigationLinkUrl"]||c&&c.relationship)return!0;var d=l(b[a])?b[a][0]:b[a];return De(d)},Fe=function(a){return Za(a)||Va(a)||Wa(a)},Ge=function(a,b,c,d,e){for(var f in a)if(f.indexOf(".")>0&&"#"!==f.charAt(0)){var g=Ae(f);if(g){var h=g.name,i=g.target,j=null,k=null;i&&(j=Ce(i,d),k=Be(i,a[i],a,j,e)),g.isOData?He(h,i,k,a[f],a,b,c):b[f]=a[f]}}return b},He=function(a,b,c,d,e,f,g){var h=a.substring("odata.".length);switch(h){case"navigationLinkUrl":return void Le(h,b,c,d,e,f,g);case"nextLink":case"count":return void Je(h,b,d,f,g);case"mediaReadLink":case"mediaEditLink":case"mediaContentType":case"mediaETag":return void Ke(h,b,c,d,f,g);default:return void Ie(h,b,d,f,g)}},Ie=function(a,b,c,d,e){var f=d.__metadata=d.__metadata||{},g=ye[a]||a;if("editLink"===a)return f.uri=A(c,e),void(f[g]=f.uri);if("readLink"!==a&&"associationLinkUrl"!==a||(c=A(c,e)),b){var h=f.properties=f.properties||{},i=h[b]=h[b]||{};return"type"===a?void(i[g]=i[g]||c):void(i[g]=c)}f[g]=c},Je=function(a,b,c,d,e){var f=ye[a];(b?d[b]:d)[f]="nextLink"===a?A(c,e):c},Ke=function(a,b,c,d,e,f){var g=e.__metadata=e.__metadata||{},h=ye[a];if("mediaReadLink"!==a&&"mediaEditLink"!==a||(d=A(d,f)),b){var i=g.properties=g.properties||{},j=i[b]=i[b]||{};return j.type=j.type||c,e.__metadata=g,e[b]=e[b]||{__mediaresource:{}},void(e[b].__mediaresource[h]=d)}g[h]=d},Le=function(a,b,c,d,e,f,g){var h=f.__metadata=f.__metadata||{},i=h.properties=h.properties||{},j=i[b]=i[b]||{},k=A(d,g);if(e.hasOwnProperty(b))return void(j.navigationLinkUrl=k);f[b]={__deferred:{uri:k}},j.type=j.type||c},Me=function(a,b,c,d,e,f,g){if("string"==typeof a)return Ne(a,b,g);if(!Fe(b)){if(l(a))return Oe(a,b,c,d,f,g);if(Qa(a))return Pe(a,b,c,d,f,g)}return a},Ne=function(a,b,c){switch(b){case"Edm.Time":return vb(a);case"Edm.DateTime":return sb(a,!1);case"Edm.DateTimeOffset":return tb(a,!1)}return c?sb(a,!0)||tb(a,!0)||a:a},Oe=function(a,b,c,d,e,f){var g,h,i=Ka(b),j=[],k=[];for(g=0,h=a.length;g<h;g++){var l=Be(null,a[g])||i,m={type:l},n=Me(a[g],l,m,d,0,e,f);Fe(l)||Ya(a[g])||j.push(m),k.push(n)}return j.length>0&&(c.elements=j),{__metadata:{type:b},results:k}},Pe=function(a,b,c,d,e,f){var g=Re(a,{type:b},d,e,f),h=g.__metadata,i=h.properties;return i&&(c.properties=i,delete h.properties),g},Qe=function(a,b,c,d,e){return l(a)?Te(a,b,c,d,e):Qa(a)?Re(a,b,c,d,e):null},Re=function(a,b,c,d,e){b=b||{};var f=a["odata.type"]||b.type||null,g=db(f,d),h=!0;g||(h=!1,g=cb(f,d));var i,j={type:f},k={__metadata:j},l={};if(h&&g&&b.entitySet&&"minimalmetadata"==b.contentTypeOdata){var m=c.substring(0,c.lastIndexOf("$metadata"));for(i=null,g.key||(i=g);i&&!i.key&&i.baseType;)i=db(i.baseType,d);if(g.key||i&&i.key){var n;if(n=g.key?Ue(a,g):Ue(a,i)){var o={key:n,entitySet:b.entitySet,functionImport:b.functionImport,containerName:b.containerName};Ve(a,o,f,m,g,i)}}}for(var p in a)if(0===p.indexOf("#"))Se(p.substring(1),a[p],k,c,d);else if(-1===p.indexOf(".")){j.properties||(j.properties=l);var q=a[p],r=r=Ce(p,g);for(i=g;g&&null===r&&i.baseType;)i=db(i.baseType,d),r=r=Ce(p,i);var s=Ee(p,a,r),t=Be(p,q,a,r,d),u=l[p]=l[p]||{type:t};if(s){var v={};if(void 0!==b.entitySet){var w=ib(r,b.entitySet.name,d);v=jb(w,d)}v.contentTypeOdata=b.contentTypeOdata,v.kind=b.kind,v.type=t,k[p]=Qe(q,v,c,d,e)}else k[p]=Me(q,t,u,c,0,d,e)}return Ge(a,k,c,g,d)},Se=function(a,b,c,d,e){if(a&&(l(b)||Qa(b))){var f=!1,g=a.lastIndexOf("."),h=a.substring(g+1),i=g>-1?a.substring(0,g):"",j=h===a||-1===i.indexOf(".")?eb(e):fb(i,e);if(j){var k=gb(j.functionImport,h);k&&k.isSideEffecting&&(f=!pb(k.isSideEffecting))}var m,n,o=c.__metadata,p=f?"functions":"actions",q=A(a,d),r=l(b)?b:[b];for(m=0,n=r.length;m<n;m++){var s=r[m];if(s){var t=o[p]=o[p]||[],u={metadata:q,title:s.title,target:A(s.target,d)};t.push(u)}}}},Te=function(a,b,c,d,e){var f,g,h,i=l(a)?a:a.value,j=[];for(f=0,g=i.length;f<g;f++)h=Re(i[f],b,c,d,e),j.push(h);var k={results:j};if(Qa(a)){for(var m in a)0===m.indexOf("#")&&(k.__metadata=k.__metadata||{},Se(m.substring(1),a[m],k,c,d));k=Ge(a,k,c)}return k},Ue=function(a,b){var c,d,e=b.key.propertyRef;if(c="(",1==e.length)d=_a(b.property,e[0].name).type,c+=Ze(a[e[0].name],d);else for(var f=!0,g=0;g<e.length;g++)f?f=!1:c+=",",d=_a(b.property,e[g].name).type,c+=e[g].name+"="+Ze(a[e[g].name],d);return c+=")"},Ve=function(a,b,c,d,e,f){var g=a[ze.id]||a[ze.read]||a[ze.edit]||b.entitySet.name+b.key;if(a[ze.id]=d+g,a[ze.edit]||(a[ze.edit]=b.entitySet.name+b.key,b.entitySet.entityType!=c&&(a[ze.edit]+="/"+c)),a[ze.read]=a[ze.read]||a[ze.edit],!a[ze.etag]){var h=We(a,e,f);h&&(a[ze.etag]=h)}af(a,e,f),Ye(a,e,f),_e(a,b)},We=function(a,b,c){for(var d,e="",f=0;b.property&&f<b.property.length;f++)d=b.property[f],e=Xe(a,e,d);if(c)for(f=0;c.property&&f<c.property.length;f++)d=c.property[f],e=Xe(a,e,d);return e.length>0?e+'"':null},Xe=function(a,b,c){return"Fixed"==c.concurrencyMode&&(b.length>0?b+=",":b+='W/"',null!==a[c.name]?b+=Ze(a[c.name],c.type):b+="null"),b},Ye=function(a,b,c){for(var d,e,f,g=0;b.navigationProperty&&g<b.navigationProperty.length;g++)d=b.navigationProperty[g].name,e=d+"@odata.navigationLinkUrl",void 0===a[e]&&(a[e]=a[ze.edit]+"/"+encodeURIComponent(d)),f=d+"@odata.associationLinkUrl",void 0===a[f]&&(a[f]=a[ze.edit]+"/$links/"+encodeURIComponent(d));if(c&&c.navigationProperty)for(g=0;g<c.navigationProperty.length;g++)d=c.navigationProperty[g].name,e=d+"@odata.navigationLinkUrl",void 0===a[e]&&(a[e]=a[ze.edit]+"/"+encodeURIComponent(d)),f=d+"@odata.associationLinkUrl",void 0===a[f]&&(a[f]=a[ze.edit]+"/$links/"+encodeURIComponent(d))},Ze=function(a,b){switch(a=""+$e(a,b),a=encodeURIComponent(a.replace("'","''")),b){case"Edm.Binary":return"X'"+a+"'";case"Edm.DateTime":return"datetime'"+a+"'";case"Edm.DateTimeOffset":return"datetimeoffset'"+a+"'";case"Edm.Decimal":return a+"M";case"Edm.Guid":return"guid'"+a+"'";case"Edm.Int64":return a+"L";case"Edm.Float":return a+"f";case"Edm.Double":return a+"D";case"Edm.Geography":return"geography'"+a+"'";case"Edm.Geometry":return"geometry'"+a+"'";case"Edm.Time":return"time'"+a+"'";case"Edm.String":return"'"+a+"'";default:return a}},$e=function(a,b){switch(b){case"Edm.Binary":return D(a);default:return a}},_e=function(a,b){for(var c=b.functionImport||[],d=0;d<c.length;d++)if(c[d].isBindable&&c[d].parameter[0]&&c[d].parameter[0].type==b.entitySet.entityType){var e="#"+b.containerName+"."+c[d].name;void 0==a[e]&&(a[e]={title:c[d].name,target:a[ze.edit]+"/"+c[d].name})}},af=function(a,b,c){(b.hasStream||c&&c.hasStream)&&(a[ze.mediaEdit]=a[ze.mediaEdit]||a[ze.mediaEdit]+"/$value",a[ze.mediaRead]=a[ze.mediaRead]||a[ze.mediaEdit])},bf=function(a,b,c,d){var e={type:b},f=Me(a.value,b,e,c,0,null,d);return Ge(a,{__metadata:e,value:f},c)},cf=function(a,b,c,d,e){var f={},g=Oe(a.value,b,f,c,d,e);return j(g.__metadata,f),Ge(a,g,c)},df=function(a,b){var c=a.value;if(!l(c))return ef(a,b);var d,e,f=[];for(d=0,e=c.length;d<e;d++)f.push(ef(c[d],b));return Ge(a,{results:f},b)},ef=function(a,b){var c={uri:A(a.url,b)};c=Ge(a,c,b);var d=c.__metadata||{},e=d.properties||{};return ff(e.url),p(e,"url","uri"),c},ff=function(a){a&&delete a.type},gf=function(a,b){var c=a.value,d=[],e=Ge(a,{collections:d},b),f=e.__metadata||{},g=f.properties||{};ff(g.value),p(g,"value","collections");var h,i;for(h=0,i=c.length;h<i;h++){var j=c[h],k={title:j.name,href:A(j.url,b)};k=Ge(j,k,b),f=k.__metadata||{},g=f.properties||{},ff(g.name),ff(g.url),p(g,"name","title"),p(g,"url","href"),d.push(k)}return{workspaces:[e]}},hf=function(a,b){return{kind:a,type:b||null}},jf=function(a,b,c){var d=a["odata.metadata"];if(!d||"string"!=typeof d)return null;var e=d.lastIndexOf("#");if(-1===e)return hf("s");var f=d.indexOf("@Element",e),g=f-1;g<0&&-1===(g=d.indexOf("?",e))&&(g=d.length);var h=d.substring(e+1,g);if(h.indexOf("/$links/")>0)return hf("l");var i=h.split("/");if(i.length>=0){var j=i[0],k=i[1];if(Fe(j))return hf("p",j);if(Pa(j))return hf("c",j);var m,n,o,p=k;if(!k){var q=j.lastIndexOf("."),r=j.substring(q+1),s=r===j?eb(b):fb(j.substring(0,q),b);s&&(m=bb(s.entitySet,r),n=s.functionImport,o=s.name,p=m?m.entityType:null)}var t;if(f>0)return t=hf("o",p),t.entitySet=m,t.functionImport=n,t.containerName=o,t;if(p)return t=hf("f",p),t.entitySet=m,t.functionImport=n,t.containerName=o,t;if(l(a.value)&&!cb(j,b)){var u=a.value[0];if(!Ya(u)&&(De(u)||!c))return hf("f",null)}return hf("o",j)}return null},kf=function(a,b,c,d,e){if(!Qa(a))return a;e=e||"minimalmetadata";var g=a["odata.metadata"],h=jf(a,b,d);f(h)&&(h.contentTypeOdata=e);var i=null;if(h)switch(delete a["odata.metadata"],i=h.type,h.kind){case"f":return Te(a,h,g,b,c);case"c":return cf(a,i,g,b,c);case"p":return bf(a,i,g,c);case"s":return gf(a,g);case"l":return df(a,g)}return Re(a,h,g,b,c)},lf=["type","etag","media_src","edit_media","content_type","media_etag"],mf=function(a,b){var c=/\/\$links\//,d={},e=a.__metadata,f=b&&c.test(b.request.requestUri);return of(a,e&&e.properties,d,f),d},nf=function(a,b){if(a){var c,d;for(c=0,d=lf.length;c<d;c++){var e=lf[c];wf("odata."+(ye[e]||e),null,a[e],b)}}},of=function(a,b,c,d){for(var e in a){var f=a[e];"__metadata"===e?nf(f,c):-1===e.indexOf(".")?d&&"uri"===e?qf(f,c):pf(e,f,b,c,d):c[e]=f}},pf=function(a,b,c,d){var e=c&&c[a]||{properties:void 0,type:void 0},f=Aa(b,e);return Ya(b)||!b?(wf("odata.type",a,f,d),void(d[a]=b)):Ua(b,f)||Ta(b)?void tf(a,b,d):!f&&Sa(b)?void rf(a,b,d):Oa(b,f)?(Ka(f)&&wf("odata.type",a,f,d),void sf(a,b,d)):(d[a]={},wf("odata.type",null,f,d[a]),void of(b,e.properties,d[a]))},qf=function(a,b){b.url=a},rf=function(a,b,c){wf("odata.navigationLinkUrl",a,b.__deferred.uri,c)},sf=function(a,b,c){c[a]=[];var d=l(b)?b:b.results;of(d,null,c[a])},tf=function(a,b,c){if(Ua(b)){c[a]=[];var d,e,f=l(b)?b:b.results;for(d=0,e=f.length;d<e;d++)uf(a,f[d],!0,c)}else uf(a,b,!1,c)},uf=function(a,b,c,d){var e=b.__metadata&&b.__metadata.uri;if(e)return void vf(a,e,c,d);var f=mf(b);if(c)return void d[a].push(f);d[a]=f},vf=function(a,b,c,d){var e=a+"@odata.bind";if(c)return d[e]=d[e]||[],void d[e].push(b);d[e]=b},wf=function(a,b,c,d){void 0!==c&&(b?d[b+"@"+a]=c:d[a]=c)},xf=Kb("application/json"),yf=function(a){var b=[];for(var c in a){var d,e;for(d=0,e=a[c].length;d<e;d++)b.push(j({metadata:c},a[c][d]))}return b},zf=function(a,b,c,d){if(a&&"object"==typeof a){var e,f=a.__metadata;f&&(f.actions&&(f.actions=yf(f.actions)),f.functions&&(f.functions=yf(f.functions)),e=f&&f.type);var g,h=db(e,b)||cb(e,b);if(h){var i=h.property;if(i){var j,k;for(j=0,k=i.length;j<k;j++){var l=i[j],m=l.name;if(g=a[m],"Edm.DateTime"===l.type||"Edm.DateTimeOffset"===l.type){if(g){if(!(g=c(g)))throw{message:"Invalid date/time value"};a[m]=g}}else"Edm.Time"===l.type&&(a[m]=vb(g))}}}else if(d)for(var n in a)"string"==typeof(g=a[n])&&(a[n]=c(g)||g)}return a},Af=function(a){if(a){var b=a.properties.odata;return"nometadata"===b||"minimalmetadata"===b||"fullmetadata"===b}return!1},Bf=function(a,b){var c,d,e={collections:[]};for(c=0,d=a.EntitySets.length;c<d;c++){var f=a.EntitySets[c],g={title:f,href:A(f,b)};e.collections.push(g)}return{workspaces:[e]}},Cf=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/,Df=function(a){var b;a<0?(b="-",a=-a):b="+";var c=Math.floor(a/60);return a-=60*c,b+Ia(c,2)+":"+Ia(a,2)},Ef=function(a){var b=a&&Cf.exec(a);if(b){var c=new Date(o(b[1]));if(b[2]){var d=o(b[3]);"-"===b[2]&&(d=-d);var e=c.getUTCMinutes();c.setUTCMinutes(e-d),c.__edmType="Edm.DateTimeOffset",c.__offset=Df(d)}if(!isNaN(c.valueOf()))return c}},Ff=function(b,c,d){var e=h(d.recognizeDates,b.recognizeDates),f=h(d.inferJsonLightFeedAsObject,b.inferJsonLightFeedAsObject),g=d.metadata,i=d.dataServiceVersion,j=Ef,k="string"==typeof c?a.JSON.parse(c):c;if(mb("3.0",i)===i){if(Af(d.contentType))return kf(k,g,e,f,d.contentType.properties.odata);j=sb}return k=zb(k.d,function(a,b){return zf(b,g,j,e)}),k=Kf(k,d.dataServiceVersion),Jf(k,d.response.requestUri)},Gf=function(b){var c,d=Date.prototype.toJSON;try{Date.prototype.toJSON=function(){return Ga(this)},c=a.JSON.stringify(b,If)}finally{Date.prototype.toJSON=d}return c},Hf=function(a,b,c){var d=c.dataServiceVersion||"1.0",e=h(c.useJsonLight,a.useJsonLight),f=c.contentType=c.contentType||xf;if(f&&f.mediaType===xf.mediaType){var g=b;return e||Af(f)?(c.dataServiceVersion=mb(d,"3.0"),g=mf(b,c),Gf(g)):(mb("3.0",d)===d&&(f.properties.odata="verbose",c.contentType=f),Gf(g))}},If=function(a,b){return b&&"Edm.Time"===b.__edmType?Ha(b):b},Jf=function(a,b){return Qa(a)&&!a.__metadata&&l(a.EntitySets)?Bf(a,b):a},Kf=function(a,b){return b&&b.lastIndexOf(";")===b.length-1&&(b=b.substr(0,b.length-1)),b&&"1.0"!==b||l(a)&&(a={results:a}),a},Lf=Wb(Ff,Hf,"application/json","3.0");Lf.recognizeDates=!1,Lf.useJsonLight=!1,Lf.inferJsonLightFeedAsObject=!1,d.jsonHandler=Lf;var Mf=/^HTTP\/1\.\d (\d{3}) (.*)$/i,Nf=/^([^()<>@,;:\\"\/[\]?={} \t]+)\s?:\s?(.*)/,Of=function(){return Math.floor(65536*(1+Math.random())).toString(16).substr(1)},Pf=function(a){return a+Of()+"-"+Of()+"-"+Of()},Qf=function(a){return a.handler.partHandler},Rf=function(a){var b=a.boundaries;return b[b.length-1]},Sf=function(a,b,c){var d=c.contentType.properties.boundary;return{__batchResponses:Uf(b,{boundaries:[d],handlerContext:c})}},Tf=function(a,b,c){if("multipart/mixed"===(c.contentType=c.contentType||Kb("multipart/mixed")).mediaType)return Zf(b,c)},Uf=function(a,b){var c="--"+Rf(b);Yf(a,b,c),Xf(a,b);for(var d,e=[];"--"!==d&&b.position<a.length;){var f,g=Vf(a,b),h=Kb(g["Content-Type"]);if(h&&"multipart/mixed"===h.mediaType){b.boundaries.push(h.properties.boundary);try{f=Uf(a,b)}catch(j){j.response=Wf(a,b,c),f=[j]}e.push({__changeResponses:f}),b.boundaries.pop(),Yf(a,b,"--"+Rf(b))}else{if(!h||"application/http"!==h.mediaType)throw{message:"invalid MIME part type "};Xf(a,b);var i=Wf(a,b,c);try{i.statusCode>=200&&i.statusCode<=299?Qf(b.handlerContext).read(i,b.handlerContext):i={message:"HTTP request failed",response:i}}catch(j){i=j}e.push(i)}d=a.substr(b.position,2),Xf(a,b)}return e},Vf=function(a,b){var c,d,e,f={};do{e=b.position,d=Xf(a,b),c=Nf.exec(d),null!==c?f[c[1]]=c[2]:b.position=e}while(d&&c);return ob(f),f},Wf=function(a,b,c){var d,e,f,g=b.position,h=Mf.exec(Xf(a,b));return h?(d=h[1],e=h[2],f=Vf(a,b),Xf(a,b)):b.position=g,{statusCode:d,statusText:e,headers:f,body:Yf(a,b,c)}},Xf=function(a,b){return Yf(a,b,"\r\n")},Yf=function(a,b,c){var d=b.position||0,e=a.length;if(c){if(-1===(e=a.indexOf(c,d)))return null;b.position=e+c.length}else b.position=e;return a.substring(d,e)},Zf=function(a,b){if(!Ma(a))throw{message:"Data is not a batch object."};var c,d,e=Pf("batch_"),f=a.__batchRequests,g="";for(c=0,d=f.length;c<d;c++)g+=$f(e,!1)+_f(f[c],b);return g+=$f(e,!0),b.contentType.properties.boundary=e,g},$f=function(a,b){var c="\r\n--"+a;return b&&(c+="--"),c+"\r\n"},_f=function(a,b,c){var d,e=a.__changeRequests;if(l(e)){if(c)throw{message:"Not Supported: change set nested in other change set"};var f=Pf("changeset_");d="Content-Type: multipart/mixed; boundary="+f+"\r\n";var g,h;for(g=0,h=e.length;g<h;g++)d+=$f(f,!1)+_f(e[g],b,!0);d+=$f(f,!0)}else{d="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n";var i=j({},b);i.handler=Wb,i.request=a,i.contentType=null,xb(a,Qf(b),i),d+=ag(a)}return d},ag=function(a){var b=(a.method?a.method:"GET")+" "+a.requestUri+" HTTP/1.1\r\n";for(var c in a.headers)a.headers[c]&&(b=b+c+": "+a.headers[c]+"\r\n");return b+="\r\n",a.body&&(b+=a.body),b};d.batchHandler=Wb(Sf,Tf,"multipart/mixed","3.0");var bg=[d.jsonHandler,d.atomHandler,d.xmlHandler,d.textHandler],cg=function(a,b,c){var d,e;for(d=0,e=bg.length;d<e&&!bg[d][a](b,c);d++);
if(d===e)throw{message:"no handler for data"}};d.defaultSuccess=function(b){a.alert(a.JSON.stringify(b))},d.defaultError=q,d.defaultHandler={read:function(a,b){a&&f(a.body)&&a.headers["Content-Type"]&&cg("read",a,b)},write:function(a,b){cg("write",a,b)},maxDataServiceVersion:"3.0",accept:"application/atomsvc+xml;q=0.8, application/json;odata=fullmetadata;q=0.7, application/json;q=0.5, */*;q=0.1"},d.defaultMetadata=[],d.read=function(a,b,c,e,f,g){var h;return h=a instanceof String||"string"==typeof a?{requestUri:a}:a,d.request(h,b,c,e,f,g)},d.request=function(a,b,c,e,f,g){b=b||d.defaultSuccess,c=c||d.defaultError,e=e||d.defaultHandler,f=f||d.defaultHttpClient,g=g||d.defaultMetadata,a.recognizeDates=h(a.recognizeDates,d.jsonHandler.recognizeDates),a.callbackParameterName=h(a.callbackParameterName,d.defaultHttpClient.callbackParameterName),a.formatQueryString=h(a.formatQueryString,d.defaultHttpClient.formatQueryString),a.enableJsonpCallback=h(a.enableJsonpCallback,d.defaultHttpClient.enableJsonpCallback),a.useJsonLight=h(a.useJsonLight,d.jsonHandler.enableJsonpCallback),a.inferJsonLightFeedAsObject=h(a.inferJsonLightFeedAsObject,d.jsonHandler.inferJsonLightFeedAsObject);var i={metadata:g,recognizeDates:a.recognizeDates,callbackParameterName:a.callbackParameterName,formatQueryString:a.formatQueryString,enableJsonpCallback:a.enableJsonpCallback,useJsonLight:a.useJsonLight,inferJsonLightFeedAsObject:a.inferJsonLightFeedAsObject};try{return xb(a,e,i),La(a,b,c,e,f,i)}catch(j){c(j)}},d.parseMetadata=function(a){return xe(0,a)},d.batchHandler.partHandler=d.defaultHandler;var dg=null,eg=function(){var a={v:this.valueOf(),t:"[object Date]"};for(var b in this)a[b]=this[b];return a},fg=function(a,b){if(b&&"[object Date]"===b.t){var c=new Date(b.v);for(var d in b)"t"!==d&&"v"!==d&&(c[d]=b[d]);b=c}return b},gg=function(a,b){return a.name+"#!#"+b},hg=function(a,b){return b.replace(a.name+"#!#","")},ig=function(a){this.name=a};ig.create=function(b){if(ig.isSupported())return dg=dg||a.localStorage,new ig(b);throw{message:"Web Storage not supported by the browser"}},ig.isSupported=function(){return!!a.localStorage},ig.prototype.add=function(a,b,c,d){d=d||this.defaultError;var e=this;this.contains(a,function(f){f?i(d,{message:"key already exists",key:a}):e.addOrUpdate(a,b,c,d)},d)},ig.prototype.addOrUpdate=function(b,c,d,e){if(e=e||this.defaultError,b instanceof Array)e({message:"Array of keys not supported"});else{var f=gg(this,b),g=Date.prototype.toJSON;try{var h=c;void 0!==h&&(Date.prototype.toJSON=eg,h=a.JSON.stringify(c)),dg.setItem(f,h),i(d,b,c)}catch(j){22===j.code||2147942414===j.number?i(e,{name:"QUOTA_EXCEEDED_ERR",error:j}):i(e,j)}finally{Date.prototype.toJSON=g}}},ig.prototype.clear=function(a,b){b=b||this.defaultError;try{for(var c=0,d=dg.length;d>0&&c<d;){var e=dg.key(c);e!==hg(this,e)?(dg.removeItem(e),d=dg.length):c++}i(a)}catch(f){i(b,f)}},ig.prototype.close=function(){},ig.prototype.contains=function(a,b,c){c=c||this.defaultError;try{var d=gg(this,a),e=dg.getItem(d);i(b,null!==e)}catch(f){i(c,f)}},ig.prototype.defaultError=q,ig.prototype.getAllKeys=function(a,b){b=b||this.defaultError;var c,d,e=[];try{for(c=0,d=dg.length;c<d;c++){var f=dg.key(c),g=hg(this,f);f!==g&&e.push(g)}i(a,e)}catch(h){i(b,h)}},ig.prototype.mechanism="dom",ig.prototype.read=function(b,c,d){if(d=d||this.defaultError,b instanceof Array)d({message:"Array of keys not supported"});else try{var e=gg(this,b),f=dg.getItem(e);f=null!==f&&"undefined"!==f?a.JSON.parse(f,fg):void 0,i(c,b,f)}catch(g){i(d,g)}},ig.prototype.remove=function(a,b,c){if(c=c||this.defaultError,a instanceof Array)c({message:"Batches not supported"});else try{var d=gg(this,a);dg.removeItem(d),i(b)}catch(e){i(c,e)}},ig.prototype.update=function(a,b,c,d){d=d||this.defaultError;var e=this;this.contains(a,function(f){f?e.addOrUpdate(a,b,c,d):i(d,{message:"key not found",key:a})},d)};var jg=a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB||a.indexedDB,kg=a.IDBKeyRange||a.webkitIDBKeyRange,lg=a.IDBTransaction||a.webkitIDBTransaction||{},mg=lg.READ_ONLY||"readonly",ng=lg.READ_WRITE||"readwrite",og=function(a,b){return function(c){var d=a||b;if(d){if("[object IDBDatabaseException]"===Object.prototype.toString.call(c))return 11===c.code?void d({name:"QuotaExceededError",error:c}):void d(c);var e;try{var f=c.target.error||c;e=f.name}catch(g){e="blocked"===c.type?"IndexedDBBlocked":"UnknownError"}d({name:e,error:c})}}},pg=function(a,b,c){var d=a.name,e="_datajs_"+d,f=jg.open(e);f.onblocked=c,f.onerror=c,f.onupgradeneeded=function(){var a=f.result;a.objectStoreNames.contains(d)||a.createObjectStore(d)},f.onsuccess=function(a){var e=f.result;if(!e.objectStoreNames.contains(d)){if("setVersion"in e){var g=e.setVersion("1.0");return g.onsuccess=function(){g.transaction.oncomplete=function(){b(e)},e.createObjectStore(d,null,!1)},g.onerror=c,void(g.onblocked=c)}return a.target.error={name:"DBSchemaMismatch"},void c(a)}e.onversionchange=function(a){a.target.close()},b(e)}},qg=function(a,b,c,d){var e=a.name,f=a.db,g=og(d,a.defaultError);if(f)return void c(f.transaction(e,b));pg(a,function(d){a.db=d,c(d.transaction(e,b))},g)},rg=function(a){this.name=a};rg.create=function(a){if(rg.isSupported())return new rg(a);throw{message:"IndexedDB is not supported on this browser"}},rg.isSupported=function(){return!!jg},rg.prototype.add=function(a,b,c,d){var e=this.name,f=this.defaultError,g=[],h=[];a instanceof Array?(g=a,h=b):(g=[a],h=[b]),qg(this,ng,function(i){i.onabort=og(d,f),i.oncomplete=function(){a instanceof Array?c(g,h):c(a,b)};for(var j=0;j<g.length&&j<h.length;j++)i.objectStore(e).add({v:h[j]},g[j])},d)},rg.prototype.addOrUpdate=function(a,b,c,d){var e=this.name,f=this.defaultError,g=[],h=[];a instanceof Array?(g=a,h=b):(g=[a],h=[b]),qg(this,ng,function(i){i.onabort=og(d,f),i.oncomplete=function(){a instanceof Array?c(g,h):c(a,b)};for(var j=0;j<g.length&&j<h.length;j++){var k={v:h[j]};i.objectStore(e).put(k,g[j])}},d)},rg.prototype.clear=function(a,b){var c=this.name,d=this.defaultError;qg(this,ng,function(e){e.onerror=og(b,d),e.oncomplete=function(){a()},e.objectStore(c).clear()},b)},rg.prototype.close=function(){this.db&&(this.db.close(),this.db=null)},rg.prototype.contains=function(a,b,c){var d=this.name,e=this.defaultError;qg(this,mg,function(f){var g=f.objectStore(d),h=g.get(a);f.oncomplete=function(){b(!!h.result)},f.onerror=og(c,e)},c)},rg.prototype.defaultError=q,rg.prototype.getAllKeys=function(a,b){var c=this.name,d=this.defaultError;qg(this,ng,function(e){var f=[];e.oncomplete=function(){a(f)};var g=e.objectStore(c).openCursor();g.onerror=og(b,d),g.onsuccess=function(a){var b=a.target.result;b&&(f.push(b.key),b["continue"].call(b))}},b)},rg.prototype.mechanism="indexeddb",rg.prototype.read=function(a,b,c){var d=this.name,e=this.defaultError,f=a instanceof Array?a:[a];qg(this,mg,function(g){var h=[];g.onerror=og(c,e),g.oncomplete=function(){a instanceof Array?b(f,h):b(f[0],h[0])};for(var i=0;i<f.length;i++){var j=g.objectStore(d);j.get.call(j,f[i]).onsuccess=function(a){var b=a.target.result;h.push(b?b.v:void 0)}}},c)},rg.prototype.remove=function(a,b,c){var d=this.name,e=this.defaultError,f=a instanceof Array?a:[a];qg(this,ng,function(a){a.onerror=og(c,e),a.oncomplete=function(){b()};for(var g=0;g<f.length;g++){var h=a.objectStore(d);h["delete"].call(h,f[g])}},c)},rg.prototype.update=function(a,b,c,d){var e=this.name,f=this.defaultError,g=[],h=[];a instanceof Array?(g=a,h=b):(g=[a],h=[b]),qg(this,ng,function(i){i.onabort=og(d,f),i.oncomplete=function(){a instanceof Array?c(g,h):c(a,b)};for(var j=0;j<g.length&&j<h.length;j++){var k=i.objectStore(e).openCursor(kg.only(g[j])),l={v:h[j]};k.pair={key:g[j],value:l},k.onsuccess=function(a){var b=a.target.result;b?b.update(a.target.pair.value):i.abort()}}},d)};var sg=function(a){var b=[],c=[],d={};this.name=a;var e=function(a){return a||this.defaultError},f=function(a,b){var c;return a instanceof Array&&(c="Array of keys not supported"),void 0!==a&&null!==a||(c="Invalid key"),!c||(i(b,{message:c}),!1)};this.add=function(a,b,c,g){g=e(g),f(a,g)&&(d.hasOwnProperty(a)?g({message:"key already exists",key:a}):this.addOrUpdate(a,b,c,g))},this.addOrUpdate=function(a,g,h,j){if(j=e(j),f(a,j)){var k=d[a];void 0===k&&(k=b.length>0?b.splice(0,1):c.length),c[k]=g,d[a]=k,i(h,a,g)}},this.clear=function(a){c=[],d={},b=[],i(a)},this.contains=function(a,b){var c=d.hasOwnProperty(a);i(b,c)},this.getAllKeys=function(a){var b=[];for(var c in d)b.push(c);i(a,b)},this.read=function(a,b,g){if(g=e(g),f(a,g)){var h=d[a];i(b,a,c[h])}},this.remove=function(a,g,h){if(h=e(h),f(a,h)){var j=d[a];void 0!==j&&(j===c.length-1?c.pop():(c[j]=void 0,b.push(j)),delete d[a],0===c.length&&(b=[])),i(g)}},this.update=function(a,b,c,g){g=e(g),f(a,g)&&(d.hasOwnProperty(a)?this.addOrUpdate(a,b,c,g):g({message:"key not found",key:a}))}};sg.create=function(a){return new sg(a)},sg.isSupported=function(){return!0},sg.prototype.close=function(){},sg.prototype.defaultError=q,sg.prototype.mechanism="memory";var tg={indexeddb:rg,dom:ig,memory:sg};c.defaultStoreMechanism="best",c.createStore=function(a,b){b||(b=c.defaultStoreMechanism),"best"===b&&(b=ig.isSupported()?"dom":"memory");var d=tg[b];if(d)return d.create(a);throw{message:"Failed to create store",name:a,mechanism:b}};var ug=function(a,b){return a+(a.indexOf("?")>=0?"&":"?")+b},vg=function(a,b){var c=a.indexOf("?"),d="";return c>=0&&(d=a.substr(c),a=a.substr(0,c)),"/"!==a[a.length-1]&&(a+="/"),a+b+d},wg=function(a,b){return{method:"GET",requestUri:a,user:b.user,password:b.password,enableJsonpCallback:b.enableJsonpCallback,callbackParameterName:b.callbackParameterName,formatQueryString:b.formatQueryString}},xg=function(a,b,c,d){return yg(a,b,[],c,d)},yg=function(a,b,c,e,f){var g=wg(a,b),h=d.request(g,function(a){var d=a.__next,g=a.results;c=c.concat(g),d?h=yg(d,b,c,e,f):e(c)},f,void 0,b.httpClient,b.metadata);return{abort:function(){h.abort()}}},zg=function(a){var b=this,c=a.source;return b.identifier=z(encodeURI(decodeURI(c))),b.options=a,b.count=function(a,e){var f=b.options;return d.request(wg(vg(c,"$count"),f),function(b){var c=o(b.toString());isNaN(c)?e({message:"Count is NaN",count:c}):a(c)},e,void 0,f.httpClient,f.metadata)},b.read=function(a,d,e,f){return xg(ug(c,"$skip="+a+"&$top="+d),b.options,e,f)},b},Ag=function(a,b){var c=Bg(a,b);if(c){var d=c.i-b.i,e=d+(a.c-a.d.length);a.d=a.d.concat(b.d.slice(d,e))}},Bg=function(a,b){var c,d=a.i+a.c,e=b.i+b.c,f=a.i>b.i?a.i:b.i,g=d<e?d:e;return g>=f&&(c={i:f,c:g-f}),c},Cg=function(a,b){if(void 0===a||"number"!=typeof a)throw{message:"'"+b+"' must be a number."};if(isNaN(a)||a<0||!isFinite(a))throw{message:"'"+b+"' must be greater than or equal to zero."}},Dg=function(a,b){if(void 0!==a){if("number"!=typeof a)throw{message:"'"+b+"' must be a number."};if(isNaN(a)||a<=0||!isFinite(a))throw{message:"'"+b+"' must be greater than zero."}}},Eg=function(a,b){if(void 0!==a&&("number"!=typeof a||isNaN(a)||!isFinite(a)))throw{message:"'"+b+"' must be a number."}},Fg=function(a,b){var c,d;for(c=0,d=a.length;c<d;c++)if(a[c]===b)return a.splice(c,1),!0;return!1},Gg=function(a){var b=0,c=typeof a;if("object"===c&&a)for(var d in a)b+=2*d.length+Gg(a[d]);else b="string"===c?2*a.length:8;return b},Hg=function(a,b,c){return a=Math.floor(a/c)*c,b=Math.ceil((b+1)/c)*c,{i:a,c:b-a}},Ig=function(a,b,c,d,e,f,g){var h,i,j=this;j.p=b,j.i=d,j.c=e,j.d=f,j.s="start",j.canceled=!1,j.pending=g,j.oncomplete=null,j.cancel=function(){if(c){var a=j.s;"error"!==a&&"end"!==a&&"cancel"!==a&&(j.canceled=!0,l("cancel",h))}},j.complete=function(){l("end",h)},j.error=function(a){j.canceled||l("error",a)},j.run=function(a){i=a,j.transition(j.s,h)},j.wait=function(a){l("wait",a)};var k=function(b,c,d){switch(b){case"start":"init"!==c&&a(j,b,c,d);break;case"wait":a(j,b,c,d);break;case"cancel":a(j,b,c,d),j.fireCanceled(),l("end");break;case"error":a(j,b,c,d),j.canceled=!0,j.fireRejected(d),l("end");break;case"end":j.oncomplete&&j.oncomplete(j),j.canceled||j.fireResolved(),a(j,b,c,d);break;default:a(j,b,c,d)}},l=function(a,b){j.s=a,h=b,k(a,i,b)};return j.transition=l,j};Ig.prototype.fireResolved=function(){var a=this.p;a&&(this.p=null,a.resolve(this.d))},Ig.prototype.fireRejected=function(a){var b=this.p;b&&(this.p=null,b.reject(a))},Ig.prototype.fireCanceled=function(){this.fireRejected({canceled:!0,message:"Operation canceled"})};var Jg=function(b){var d,e="init",g={counts:0,netReads:0,prefetches:0,cacheReads:0},h=[],k=[],l=[],m=0,n=!1,p=s(b.cacheSize,1048576),q=0,r=0,t=0,u=0===p,v=s(b.pageSize,50),w=s(b.prefetchSize,v),x="1.0",y=0,z=b.source;"string"==typeof z&&(z=new zg(b)),z.options=b;var A=c.createStore(b.name,b.mechanism),B=this;B.onidle=b.idle,B.stats=g,B.count=function(){if(d)throw d;var a=za(),b=!1;if(n)return i(function(){a.resolve(q)}),a.promise();var c=z.count(function(b){c=null,g.counts++,a.resolve(b)},function(d){c=null,a.reject(j(d,{canceled:b}))});return j(a.promise(),{cancel:function(){c&&(b=!0,c.abort(),c=null)}})},B.clear=function(){if(d)throw d;if(0===h.length){var a=za(),b=new Ig(R,a,!1);return K(b,h),a.promise()}return h[0].p},B.filterForward=function(a,b,c){return H(a,b,c,!1)},B.filterBack=function(a,b,c){return H(a,b,c,!0)},B.readRange=function(a,b){if(Cg(a,"index"),Cg(b,"count"),d)throw d;var c=za(),e=new Ig(T,c,!0,a,b,[],0);return K(e,k),j(c.promise(),{cancel:function(){e.cancel()}})},B.ToObservable=B.toObservable=function(){if(!a.Rx||!a.Rx.Observable)throw{message:"Rx library not available - include rx.js"};if(d)throw d;return a.Rx.Observable.CreateWithDisposable(function(a){var b=!1,c=0,d=function(c){b||a.OnError(c)},e=function(f){if(!b){var g,h;for(g=0,h=f.length;g<h;g++)a.OnNext(f[g]);f.length<v?a.OnCompleted():(c+=v,B.readRange(c,v).then(e,d))}};return B.readRange(c,v).then(e,d),{Dispose:function(){b=!0}}})};var C=function(a){return function(b){d={message:a,error:b};var c,e;for(c=0,e=k.length;c<e;c++)k[c].fireRejected(d);for(c=0,e=h.length;c<e;c++)h[c].fireRejected(d);k=h=null}},D=function(a){if(a!==e){e=a;var b,c,d=h.concat(k,l);for(b=0,c=d.length;b<c;b++)d[b].run(e)}},E=function(){var a=new ya;return A.clear(function(){m=0,n=!1,q=0,r=0,t=0,u=0===p,g={counts:0,netReads:0,prefetches:0,cacheReads:0},B.stats=g,A.close(),a.resolve()},function(b){a.reject(b)}),a},F=function(a){var b=Fg(h,a);b||(b=Fg(k,a))||Fg(l,a),y--,D("idle")},G=function(a){var b=new ya,c=!1,d=z.read(a,v,function(c){var d={i:a,c:c.length,d:c};b.resolve(d)},function(a){b.reject(a)});return j(b,{cancel:function(){d&&(d.abort(),c=!0,d=null)}})},H=function(a,b,c,e){if(a=o(a),b=o(b),isNaN(a))throw{message:"'index' must be a valid number.",index:a};if(isNaN(b))throw{message:"'count' must be a valid number.",count:b};if(d)throw d;a=Math.max(a,0);var f=za(),g=[],h=!1,i=null,k=function(a,d){h||(b>=0&&g.length>=b?f.resolve(g):i=B.readRange(a,d).then(function(h){for(var i=0,j=h.length;i<j&&(b<0||g.length<b);i++){var l=e?j-i-1:i,m=h[l];if(c(m)){var n={index:a+l,item:m};e?g.unshift(n):g.push(n)}}if(!e&&h.length<d||e&&a<=0)f.resolve(g);else{var o=e?Math.max(a-v,0):a+d;k(o,v)}},function(a){f.reject(a)}))},l=Hg(a,a,v),m=e?l.i:a,n=e?a-l.i+1:l.i+l.c-a;return k(m,n),j(f.promise(),{cancel:function(){i&&i.cancel(),h=!0}})},I=function(){B.onidle&&0===y&&B.onidle()},J=function(a){if(!n&&0!==w&&!u&&(0===l.length||l[0]&&-1!==l[0].c)){var b=new Ig(S,null,!0,a,w,null,w);K(b,l)}},K=function(a,b){a.oncomplete=F,b.push(a),y++,a.run(e)},L=function(a){var b=!1,c=j(new ya,{cancel:function(){b=!0}}),d=O(c,"Read page from store failure");return A.contains(a,function(e){if(!b)return e?void A.read(a,function(a,d){b||c.resolve(void 0!==d,d)},d):void c.resolve(!1)},d),c},M=function(a,b){var c=!1,d=j(new ya,{cancel:function(){c=!0}}),e=O(d,"Save page to store failure"),f=function(){d.resolve(!0)};if(b.c>0){var g=Gg(b);u=p>=0&&p<m+g,u?f():A.addOrUpdate(a,b,function(){P(b,g),N(f,e)},e)}else P(b,0),N(f,e);return d},N=function(a,b){var c={actualCacheSize:m,allDataLocal:n,cacheSize:p,collectionCount:q,highestSavedPage:r,highestSavedPageSize:t,pageSize:v,sourceId:z.identifier,version:x};A.addOrUpdate("__settings",c,a,b)},O=function(a){return function(){a.resolve(!1)}},P=function(a,b){var c=a.c,d=a.i;0===c?r===d-v&&(q=r+t):(r=Math.max(r,d),r===d&&(t=c),m+=b,c<v&&!q&&(q=d+c)),n||q!==r+t||(n=!0)},Q=function(a,b,c,d){var e=a.canceled&&"end"!==b;return e&&"cancel"===b&&d&&d.cancel&&d.cancel(),e},R=function(a,b,c){var d=a.transition;if("destroy"!==c)return D("destroy"),!0;switch(b){case"start":d("clear");break;case"end":I();break;case"clear":E().then(function(){a.complete()}),a.wait();break;default:return!1}return!0},S=function(a,b,c,d){if(!Q(a,b,0,d)){var e=a.transition;if("prefetch"!==c)return"destroy"===c?"cancel"!==b&&a.cancel():"idle"===c&&D("prefetch"),!0;switch(b){case"start":l[0]===a&&e("local",a.i);break;case"done":var f=a.pending;f>0&&(f-=Math.min(f,d.c)),n||0===f||d.c<v||u?a.complete():(a.pending=f,e("local",d.i+v));break;default:return U(a,b,c,d,!0)}}return!0},T=function(a,b,c,d){if(!Q(a,b,0,d)){var e=a.transition;if("read"!==c&&"start"!==b)return"destroy"===c?"start"!==b&&a.cancel():"write"!==c&&D("read"),!0;switch(b){case"start":if("idle"===c||"prefetch"===c)if(D("read"),a.c>0){var f=Hg(a.i,a.c,v);e("local",f.i)}else e("done",a);break;case"done":Ag(a,d);var h=a.d.length;a.c===h||d.c<v?(g.cacheReads++,J(d.i+d.c),a.complete()):e("local",d.i+v);break;default:return U(a,b,c,d,!1)}}return!0},U=function(a,b,c,d,e){var f,h=a.error,i=a.transition,j=a.wait;switch(b){case"end":I();break;case"local":f=L(d).then(function(b,c){a.canceled||(b?i("done",c):i("source",d))});break;case"source":f=G(d).then(function(b){a.canceled||(e?g.prefetches++:g.netReads++,i("save",b))},h);break;case"save":"write"!==c&&(D("write"),f=M(d.i,d).then(function(b){a.canceled||(!b&&e&&(a.pending=0),i("done",d)),D("idle")}));break;default:return!1}return f&&(a.canceled?f.cancel():a.s===b&&j(f)),!0};return A.read("__settings",function(a,b){if(f(b)){var c=b.version;if(!c||0!==c.indexOf("1."))return void C("Unsupported cache store version "+c)();v!==b.pageSize||z.identifier!==b.sourceId?E().then(function(){D("idle")},C("Unable to clear store during initialization")):(m=b.actualCacheSize,n=b.allDataLocal,p=b.cacheSize,q=b.collectionCount,r=b.highestSavedPage,t=b.highestSavedPageSize,x=c,D("idle"))}else N(function(){D("idle")},C("Unable to write settings during initialization."))},C("Unable to read settings from store.")),B};c.createDataCache=function(a){if(Dg(a.pageSize,"pageSize"),Eg(a.cacheSize,"cacheSize"),Eg(a.prefetchSize,"prefetchSize"),!f(a.name))throw{message:"Undefined or null name",options:a};if(!f(a.source))throw{message:"Undefined source",options:a};return new Jg(a)}}(this);