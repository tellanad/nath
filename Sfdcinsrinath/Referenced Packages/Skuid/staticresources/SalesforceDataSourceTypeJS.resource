"use strict";!function(a){function b(a){return Y(a.getDataSource())}function c(){return!(!window.sforce||!sforce.one)&&sforce.one}function d(){return!!window.Aura&&window.Aura}function e(){var b,c=d(),e=window.location.search&&-1!==window.location.search.indexOf("lightning.force.com"),f=-1!==window.location.href.indexOf("one/one.app");if(c&&(e||f))return b=a.component.getByType("skuidpage")[0].getPageParameters(),"Theme4d"===b.UIThemeDescription}function f(){return!!(window.sforce&&window.sforce.console&&window.sforce.console.isInConsole())&&window.sforce.console}function g(a){for(;P(a);)try{a=JSON.parse(a)}catch(b){break}return a}function h(a,b,c,d){if(b){var e,f,g,i,j,k,l=b.split("."),m=d.getDataSource&&d.getDataSource();if("childRelationship"===a.type)(i=a.referenceTo&&a.referenceTo.length&&a.referenceTo[0])&&(j=m&&m.getCachedEntityMetadata(i.o),(k=a.subFields)&&K.each(k,function(a,b){h(b,b.id,j,d)}));else if(1===l.length){if(e=c&&c.getField&&c.getField(b)){f=d.getOverrideableFieldMetadata(a);var n=a.id,o=a.name;K.extend(!0,a,e),n&&(a.id=n),o&&(a.name=o),f&&K.each(f,function(b,c){a[b]=c})}if(a&&a["function"]){var p,q,r=a["function"];r&&(r=r.toUpperCase(),p=["CALENDAR_MONTH","CALENDAR_QUARTER","CALENDAR_YEAR","DAY_IN_MONTH","DAY_IN_WEEK","DAY_IN_YEAR","FISCAL_MONTH","FISCAL_QUARTER","FISCAL_YEAR","HOUR_IN_DAY","WEEK_IN_MONTH","WEEK_IN_YEAR"],q=["DAY_ONLY"],0===r.lastIndexOf("COUNT",0)?a.displaytype=D.INTEGER:a.displaytype!==D.DATE&&a.displaytype!==D.DATETIME||-1===p.indexOf(r)?a.displaytype==D.DATETIME&&-1!==q.indexOf(r)&&(a.displaytype=D.DATE):a.displaytype=D.STRING,a.required=a.createable=a.editable=!1)}if(a&&a.displaytype===E){var s,t,u,v;a.relationshipName||(a.relationshipName=a.rel),!a.ref&&a.referenceTo&&(s=a.referenceTo)&&s.length&&(t=[],u=[],v={c:"createable",o:"objectName",l:"label",k:"keyPrefix",p:"labelPlural",s:"searchable"},K.each(s,function(a,b){b.o&&(t.push(b.o),u.push(b.k),K.each(v,function(a,c){b[c]=b[a],delete b[a]}),b.accessible=!0)}),t.length&&(a.ref=t.join(",")),u.length&&(a.refprefix=u.join(",")))}}else b=l.shift(),b=L.getReferenceFieldNameFromRelationshipField(b),e=c&&b&&c.getField&&c.getField(b),e&&(g=e.referenceTo,g&&1===g.length?c=m&&m.getCachedEntityMetadata(g[0].objectName||g[0].o):g&&g.length>1&&(c=m&&m.getCachedEntityMetadata("Name")),c&&h(a,l.join("."),c,d)),a.required=a.createable=a.editable=!1}}function i(a){if(a&&a.fields&&a.fields.length){var b=a.getDataSource&&a.getDataSource(),c=b&&b.getCachedEntityMetadata(a.objectName);K.each(a.fields,function(b,d){h(d,d.id,c,a)})}return a}function j(a){if(!a)return"";var b=a.statusCode,c=a.body,d=b&&a.status?b+" "+a.status+": ":"";return c=g(c),c instanceof Array&&1===c.length?d+=c[0].message:c&&c.message?d+=c.message:a.error&&(d+=a.error),d}function k(b){for(var c,d={},e=L.combineUrls(b.serviceUrl,"/services/apexrest/skuid/api/v1/models"),f=0,h=["load","save","getModelMetadata","getEntityList","doSearch"];f<h.length;f++)c=h[f],d[c]=function(c){return function(d){var f,h,i,k=K.Deferred(),l=d&&!P(d)?JSON.stringify(d):d||null,m=!1,n=!1,o=window.Visualforce;return b.name===F?(i=[],l&&i.push(l),i.push(function(b,d){var e,f=!1,g=function(){n||(n=!0,window.confirm('You need to log in again, your session has expired.\n\nPress "OK" to go to the login page now.\n\nPress "Cancel" to remain on this page. Refresh your browser to go to the login page.')&&window.location.reload())},h=function(){var a=K.Deferred(),b=setTimeout(a.reject,5e3),c=K('<iframe src="/apex/" width="0" height="0"/>').css("display","none").appendTo(document.body).load(function(){clearTimeout(b),c.remove(),a.resolve()});return a.promise()},j=function(a){var b=K.Deferred(),c=setTimeout(b.reject,5e3);return a.refresh(function(){clearTimeout(c),b.resolve()}),b.promise()};if(d.status){if(P(b))try{b=JSON.parse(b)}catch(l){}k.resolve(b)}else e=d.message,e&&-1!==e.indexOf("Logged in?")?f=!0:e&&-1!==e.indexOf("Page not allowed for the profile")?f=!0:e&&-1!==e.indexOf("Remoting request invalid")&&(f=!0),f?m?(g(),k.reject(d.message)):(m=!0,function(){return h().then(function(){return K.when.all(K.map(o.remoting.Manager.providers,function(a){return j(a)}))})}().then(function(){a.remote()[c].apply(window,i)},function(){g(),k.reject(d.message)})):k.reject(d.message)},{escape:!1}),a.remote()[c].apply(window,i)):(f=l?"POST":"GET",h={method:f,url:e,headers:{"x-skuid-rest-service-method":c,"X-SKUID-REST-SERVICE-METHOD":c}},"POST"===f&&(h.body=l,h.contentType="application/json"),b.makeRequest(b.createHTTPRequest(h)).then(function(a){var b=a.body,c=a.statusCode;a.error?k.reject(a.error):b&&(b=g(b),K.inArray(c,[200,201,204])<0?k.reject(j(a)):b&&b.error&&1===L.size(b)?"Invalid Skuid Model API request method: null"===b.error&&L.inPlatform(C.NATIVE)?k.reject("The version of Skuid installed in the target Salesforce org is not compatible with Skuid Platform. Please install the latest version of Skuid into this Salesforce org."):k.reject(b.error):k.resolve(b))},function(a){k.reject(j(a))})),k.promise()}}(c);return b._sfdcRemote=d,d}function l(a){var b=a._sfdcRemote;return b||(b=new k(a)),b}function m(){return L.userInfo}function n(a){var b,c=a.fields,d=a.file,e=a.payloadField,f=a.url,g="formboundary"+Math.random().toString(36).substr(2,10),h=a.filename||d.name,i=a.dataSource,j={};b=new Blob(["--boundary_"+g+'\nContent-Disposition: form-data; name="entity_content";\nContent-Type: application/json\n\n'+JSON.stringify(c)+"\n\n--boundary_"+g+"\nContent-Type: "+d.type+'\nContent-Disposition: form-data; name="'+e+'"; filename="'+h+'"\n\n',d,"\n\n--boundary_"+g+"--"],{type:'multipart/form-data; boundary="boundary_'+g+'"'});var k=i.createHTTPRequest({url:f,headers:j,method:"POST"});return k.headers.Accept="application/json",i.name===F&&(k.headers.Authorization="Bearer "+m().sessionId),K.extend(k,{body:b,cache:!1,contentType:!!i.useApexProxy&&'multipart/form-data; boundary="boundary_'+g+'"',processData:!1}),L._ie&&(k.contentType='multipart/form-data; boundary="boundary_'+g+'"'),i.makeRequest(k)}function o(a){var b=a.path,c=a.basePath||"";return a.dataSource&&a.dataSource.name===F&&(c=""),a.accessToken=a.accessToken||m().sessionId,a.url=L.getSafeRelativeUrl(c+"/services/data"+b),n(a)}function p(a,b,c,d,e){var f=c.uploadMethod.dataSource;L.readFileAsBase64(a).then(function(g){var h,i,j,k,m,n=[],o={},p={},q={},r=b.model,s=b.row,t=b.options.xmlDef,u=t.attr("owneridfield")||"",v=s&&r?r.getRowId(s):null,w=s&&u&&s[u]?s[u]:"";o.id="imageAttachmentUpload",o.type="Attachment",p.id="imageImageInsert",p.type="skuid__Image__c",q.id="updateObject",q.type=r.objectName,i=c.description?O(c.description,{row:s,model:r},{createFields:!1}):"",k=c.filename?O(c.filename,{row:s,model:r},{createFields:!1}):a.name,j=b.fieldValue,h=b.fileId,"field"===c.storeAs?h&&j?(p.id="imageImageUpdate",p.updates={},p.updates[j]={Name:k},o.updates={},o.updates[h]={Body:g,Name:k,ContentType:a.type,Description:i},n.push(o,p),m="AttachmentUpdate"):j?(p.id="imageImageUpdate",p.updates={},p.updates[j]={Name:k},o.inserts={1:{ParentId:j,Body:g,Name:k,ContentType:a.type,Description:i}},n.push(o,p),m="CreateAttachment"):(p.inserts={1:{}},o.inserts={2:{ParentId:"1",Body:g,Name:k,ContentType:a.type,Description:i}},q.updates={},q.updates[v]={},q.updates[v][b.fieldName]="1",n.push(p,o,q),m="CreateFileAndAttachment"):"record"===c.storeAs&&(o.inserts={1:{ParentId:v,Body:g,Name:k,ContentType:a.type,Description:i}},w&&(o.inserts[1].OwnerId=w),n.push(o),m="CreateAttachment"),d({fileName:k}),l(f).save(JSON.stringify({operations:n,rollbackOnAnyError:!0})).then(function(a){var c,d,f,g,h=a.updateResults,i=a.insertResults,j=b.fieldValue;"AttachmentUpdate"===m?h&&2===h.length&&h[0].success&&h[1].success?(c=h[0].id,d=j):(g="Failure Updating Attachment",f=[],h[0].errors&&h[0].errors.length&&(f=f.concat(h[0].errors)),h[1]&&h[1].errors&&h[1].errors.length&&(f=f.concat(h[1].errors))):"CreateAttachment"===m?i&&i.length&&i[0].success?(c=i[0].id,d=j):(g="Failure Creating Attachment",f=[],h[0]&&h[0].errors&&h[0].errors.length&&(f=f.concat(h[0].errors)),i[0]&&i[0].errors&&i[0].errors.length&&(f=f.concat(i[0].errors))):"CreateFileAndAttachment"===m&&(i&&2===i.length&&h&&1===h.length?i[0].success&&i[1].success&&h[0].success?(c=i[1].id,d=i[0].id):(g="Failure Creating File and Attachment (1)",f=[],h[0].errors&&h[0].errors.length&&(f=f.concat(h[0].errors)),i[0].errors&&i[0].errors.length&&(f=f.concat(i[0].errors)),i[1].errors&&i[1].errors.length&&(f=f.concat(i[1].errors))):g="Failure Creating File and Attachment (2)"),g&&f&&f.length&&(g+=": "+K.map(f,function(a){return a.message}).join(", ")),e({newFileId:c,newFieldValue:d,newFileName:k,message:g})},function(a){e({message:a&&a.error})})},function(a){e(a)})}function q(a){var b,c,d,e,f=K.Deferred(),g=a.paramString||"",h=a.dataSource,i=a.fileField,j=a.context;return j&&(j.id?c=j.id:j.row&&(i?-1!==i.indexOf(".")?c=L.getObjectProperty(j.row,i):(d=i.substr(0,i.length-1),c=L.getObjectProperty(j.row,d+"r.skuid__AttachmentId__c")):j.model&&(e=j.model.objectName,"skuid__Image__c"===e?c=j.row.skuid__AttachmentId__c:"Attachment"===e&&(c=j.row.Id)))),c?h.name===F?f.resolve(L.getUrlFromAttachmentId(c+g)):(b=h.serviceUrl+"/services/data/v"+V+"/sobjects/Attachment/"+c+"/body",h.authenticate().then(function(){return h.makeRequest(h.createHTTPRequest({url:b,accept:"application/octet-stream"}))}).then(function(a){f.resolve("data:;base64,"+a.body)},function(a){f.reject(a)})):f.reject("No Attachment Id"),f.promise()}function r(b,c){c({message:a.ajax.getErrorMessage(b,I)})}function s(b,c,d,e,f,g){function h(a){r(a,f)}function i(a){return o({path:"/v"+V+"/sobjects/ContentVersion",basePath:j&&j.serviceUrl,fields:{Origin:a,PathOnClient:u,Description:t},payloadField:"VersionData",file:b,filename:u,dataSource:j})}var j=d.uploadMethod.dataSource,k={row:c.row,model:c.model},m={createFields:!1},n=c.options.xmlDef,p=c.row,q=n.attr("owneridfield")||"",s=p&&q&&p[q]?p[q]:"",t=d.description?O(d.description,k,m):"",u=d.filename?O(d.filename,k,m):b.name,v=d.feedtext?O(d.feedtext,k,m):"";if(e({fileName:u}),L.inPlatform(a.constants.LIGHTNING))return f({message:"Cannot upload large files in Lightning"}),!1;if("record"===d.storeAs){var w={ParentId:c.model.getRowId(c.row),Name:u,ContentType:b.type,Description:t};s&&(w.OwnerId=s),o({path:"/v"+V+"/sobjects/Attachment",basePath:j&&j.serviceUrl,fields:w,payloadField:"Body",file:b,filename:u,dataSource:j}).then(function(a){var b,c=a&&(a.response||a.body);P(c)&&(c=JSON.parse(c)),b=c.id,f({newFileId:b,newFileName:u})},h,function(a){g(a)})}else if("field"===d.storeAs){var x,y="/v"+V+"/sobjects/Attachment",z=c.fieldValue;(function(){var a=K.Deferred();if(z)a.resolve(z);else{var b=[],d={id:"imageImageInsert",inserts:{1:{}},type:"skuid__Image__c"},e={id:"updateObject",updates:{},type:c.model.objectName},f=c.model.getRowId(c.row);e.updates[f]={},e.updates[f][c.fieldName]="1",b.push(d,e),l(j).save(JSON.stringify({operations:b,rollbackOnAnyError:!0})).then(function(b){var c,d="";b.globalErrors&&b.globalErrors.length?d+=b.globalErrors.join(", "):b.insertResults&&1===b.insertResults.length&&b.updateResults&&1===b.updateResults.length?b.insertResults[0].success&&b.updateResults[0].success?c=b.insertResults[0].id:(K.each(b.insertResults[0].errors,function(){d+=this.message}),K.each(b.updateResults[0].errors,function(){d+=this.message})):d+="Error Uploading File",c?a.resolve(c):a.reject(d)},function(b){a.reject(b&&b.error)})}return a.promise()})().then(function(a){var d=c.fileId;x=a,d&&a&&(y+="/"+d+"?_HttpMethod=PATCH");var e={Name:u,ContentType:b.type,Description:t};return!d&&a&&(e.ParentId=a),o({path:y,basePath:j&&j.serviceUrl,fields:e,payloadField:"Body",file:b,filename:u,dataSource:j})}).then(function(a){var b,d=c.fileId,e=a&&(a.response||a.body);d?b=d:e&&(e=P(e)?JSON.parse(e):e,b=e.id),f({newFileId:b,newFileName:u,newFieldValue:x})},h,function(a){g(a)})}else"chatterfeed"===d.storeAs?function(){var d=a.page?a.page.community:null,e=d?d.id:null;return o({path:"/v35.0"+(e?"/connect/communities/"+e:"")+"/chatter/feed-elements",basePath:j&&j.serviceUrl,fields:{body:{messageSegments:[{type:"Text",text:v}]},capabilities:{content:{description:t,title:u}},feedElementType:"FeedItem",subjectId:c.model.getRowId(c.row)},payloadField:"feedElementFileUpload",file:b,filename:u,dataSource:j})}().then(function(){if(f(),window.chatter&&j.name===F){var a=chatter.getFeed(),b=a.getConfig();a.refresh({feedType:b.feedType,isFullRefresh:!0,params:b})}},h,function(a){g(a)}):"chatterfiles"===d.storeAs?i("H").then(function(){f()},h,function(a){g(a)}):"contentdocument"===d.storeAs&&i("C").then(function(){f()},h,function(a){g(a)})}function t(b,c,d,e,f){var g=d.filename||b.name,h=d.uploadMethod.dataSource,i=h&&h.serviceUrl?h.serviceUrl:"",j=function(a){r(a,f)};e({fileName:g}),L.readFileAsBase64(b).then(function(b){var c,d,e,k=g.split("."),l="";k.length>1&&(l=k.pop().toUpperCase()),g=k.join("")+l,c=g.match(/[a-z]|[A-Z]|[0-9]/g),g=c?c.join(""):"unnamedResource",/[0-9]/.test(g.charAt(0))&&(g="SR"+g),d=h.createHTTPRequest({url:i+"/services/data/v"+V+"/sobjects/StaticResource",headers:{"Content-Type":"application/json"},method:"POST"}),d.headers.Accept="application/json",h.name===F&&(d.headers.Authorization="Bearer "+m().sessionId),e={Name:g,ContentType:"application/"+l,Body:b,CacheControl:"Public"},K.extend(d,{body:JSON.stringify(e),contentType:"application/json"}),h.makeRequest(d).then(function(a){var b=a.body,c=b.id||b.Id;void 0!==c&&(e.Id=c),f({record:K.extend(e,a)})},function(b){var c="SELECT Id FROM StaticResource WHERE Name='"+g+"'";if(h.name!==F)return void j(b);a.sfdc.api.query(c).then(function(c){if(c.records&&c.records[0]){if(window.confirm('Static Resource "'+g+'" already exists, do you want to overwrite it?')){e.Id=c.records[0].Id;return new a.sfdc.api.SObject("StaticResource",e).update()}}return K.Deferred().reject(b).promise()}).then(function(){f({record:e})},function(a){j(a)})})})}function u(a){var b;return a&&(b=P(a)?a:a.objectName),b&&b in W?W[b]:b in X||b&&L.endsWith(b,"__x")?"Id":"Name"}function v(a,b){return b.getFieldValue(a,u(b.objectName),!0)}function w(a,b){return b.getFieldValue(a,"Id",!0)}function x(){return"Id"}function y(a){return{operations:a.operations.map(function(a){var b={updates:a.returning.map(function(a){return{id:a}}),changes:{},id:a.id,type:a.type};return a.inserts&&K.each(a.inserts,function(a,c){b.changes[a]=c}),a.updates&&K.each(a.updates,function(a,c){b.changes[a]=c}),a.deletes&&K.each(a.deletes,function(a){b.changes[a]={__deleted:!0}}),b}),rollbackOnAnyError:a.rollbackOnAnyError}}function z(b,c){var d={Case:["UseActiveAssignmentRule","SendAutoResponseEmails","SendUserNotificationEmails","AllowExternalEmails"],CaseComment:["AllowExternalEmails"],Event:["SendUserNotificationEmails","AllowExternalEmails"],Lead:["UseActiveAssignmentRule","SendAutoResponseEmails","SendUserNotificationEmails","AssignmentRuleId"],Task:["SendUserNotificationEmails"],User:["SendUserNotificationEmails"]};if(b&&b.operations)return c||(c=H),b.operations.forEach(function(b){var c=d[b.type];["inserts","updates","changes"].forEach(function(d){b[d]&&K.each(b[d],function(d,e){if(K.each(e,function(a,b){(L.endsWith(a,"__r")||L.endsWith(a,"__pr")||L.toClass.call(b)in J)&&delete e[a]}),c){var f=a.$M(b.id),g=f.changes[d];K.each(c,function(a,b){g.hasOwnProperty(b)&&(e[b]=g[b])})}})})}),c<2?y(b):b}function A(a,b){var c=b.dataSource,d=c.getCacheProperty(G);return d||(d=H,c.setPersistentCacheProperty(G,d)),c.authenticate().then(function(){return l(c).save(z(a,d)).then(function(a){return a},function(b){if(b&&b.indexOf("Invalid Skuid Save request - could not deserialize JSON into valid Save Request")>-1){var e=d>=2?1:2;return l(c).save(z(a,e)).then(function(a){return c.setPersistentCacheProperty(G,e),a})}return b})})}function B(b,c,d){d=d||"GET";var e={type:d,url:b,cache:"GET"===d,dataSource:c};return a.sfdc.api.makeRequest(e)}var C=a.constants,D=C.DISPLAY_TYPES,E=D.REFERENCE,F=C.SALESFORCE,G="x-salesforce-save-api-version",H=2,I="Could not upload file",J={"[object Object]":1,"[object Array]":1},K=a.$,L=a.utils,M=a.dataSource,N=M.utils,O=L.mergeAsTextInContext,P=L.isString,Q=a.sfdc,R=L.makeXMLDoc,S=L.getInvokable,T=L.encodeHTML,U=L.startsWith,V=Q.api.version,W={Case:"CaseNumber",ContentDocument:"Title",ContentVersion:"Title",CustomPermission:"MasterLabel",Event:"Subject",FeedItem:"Title",Idea:"Title",PartnerNetworkConnection:"ConnectionName",Solution:"SolutionName",Task:"Subject",WorkOrder:"WorkOrderNumber"},X={CampaignMember:1,AccountContactRole:1,OpportunityContactRole:1,ContractContactRole:1,CaseContactRole:1,CaseComment:1,CaseSolution:1,OpportunityLineItem:1},Y=function(a){return!a||(L.inPlatform([C.VISUALFORCE,C.LIGHTNING])?"string"==typeof a?a===F:"object"==typeof a&&a.name===F:void 0)},Z=function(b,c,d){return d=d||{},function(e,f,g){var h=e.attr("sfdcactionname")||c,i=e.attr("sobject")||"global",j=K.Deferred(),k={},l=!0,m=K.extend({},d,{sobject:i,actionName:h});if(e.children("inputs").children().each(function(){var b=S(K(this),"attr"),c=b("name"),d=b("value"),e=b("displaytype"),i=L.getContextToUse(f,g);if(!c)return j.reject({$CurrentAction:{Error:'Invalid parameter name for Salesforce Action "'+h+'"'}}),l=!1,!1;d=a.utils.mergeAsDataInContext(d,i),"BOOLEAN"===e&&(d="true"===d),k[c]=d}),!l)return j.promise();f&&f.button&&f.button.startProcessing();var n={inputs:[k]},o=$(c,m);return a.sfdc.api.makeRequest({type:"POST",url:o,dataSource:b,data:n,crossDomain:!0,success:function(a){j.resolve({$PreviousAction:{result:a[0].outputValues}})},error:function(a){var b=a.responseJSON;b&&b.length&&j.reject({$CurrentAction:{error:b[0].errors[0]}})}}).always(function(){f&&f.button&&f.button.stopProcessing()}),j.promise()}},$=function(a,b){b=b||{};var c=b.needSObject,d=b.isStandard,e=b.sobject,f=b.actionName;return d&&!f&&(f=a),f=f||"",d?"/actions/standard/"+f:c?"/actions/custom/"+a+"/"+e+"/"+f:"/actions/custom/"+a+"/"+f},_=function(a,b,c,d){var e,f=d.children("inputs");f.length&&(e=f.children()),K.each(b,function(b,g){var h=g.name,i=e?e.filter('[name="'+h+'"]'):[],j=i.length?i.attr("value"):null,k=(g.type||"TEXT").toLowerCase();"sobject"===k&&g.sobjectType&&(k="TEXT");var l={isStateless:!0,value:j,label:g.label,required:g.required,type:k.toLowerCase(),helptext:g.description,onChange:function(a){var b=!!f&&f.children('[name="'+h+'"]');a||!1===a||0===a?(b&&b.length||(b=R("<input/>").attr({name:h,displaytype:k}),(!f||f&&!f.length)&&(f=R("<inputs/>").appendTo(d)),b.appendTo(f)),b.attr("value",a)):b.remove(),c.save()}};"picklist"!==k&&"combobox"!==k||(l.picklistEntries=g.picklistValues),a.push(l)})},aa=function(b,c,d,e,f){f=f||{};var g=d&&d.component,h=d&&d.propViewer,i=f.needSObject,j=f.isStandard;return{builderProps:function(){var d=[],f=S(c,"attr"),k=i&&(f("sobject")||"global"),l=N.makeLabelFromId(e),m=f("sfdcactionname"),n=$(e,{needSObject:i,isStandard:j,sobject:k}),o=(m||j)&&$(e,{needSObject:i,isStandard:j,sobject:k,actionName:m}),p=function(a){return function(){L.removeAllAttrsExcept(c,["datasource","type","actionname"].concat(a)),g.save(),g.rebuildProps(h)}};if(i&&d.push({id:"sobject",label:"SObject",type:"combobox",defaultValue:"Global",source:N.getComboBoxOptions(function(){return B("/actions/custom/"+e,b).then(function(a){return K.map(a,function(a,b){return{label:b,value:b}})})}),onChange:p(["sobject"])}),j||d.push({id:"sfdcactionname",label:l+" action",type:"combobox",source:N.getComboBoxOptions(function(){return B(n,b).then(function(a){return K.map(a.actions,function(a){return{label:a.label,value:a.name}})})}),onChange:p(["sfdcactionname","sobject"])}),o){var q=a.sfdc.api.getCachedResult({type:"GET",url:o,dataSource:b});!q&&o?B(o,b).then(function(){g.rebuildProps(h)}):_(d,q.inputs,g,c)}return d},runtimeExecution:Z(b,e,f),label:f.label||N.makeLabelFromId(e),name:e}};new a.dataSource.DataSourceType({name:F,prefillMetadataForObject:function(a){i(a.data)},getNameField:u,getIdField:x,getRowId:w,getRowName:v,save:A,load:function(a,b){var c=b.dataSource;return c.authenticate().then(function(){var d,e=["conditionLogic","doQuery","forView","groupByMethod","havingLogic","id","objectName","orderByClause","offsetPageNumber","offsetPageSize","offsetSize","queryAllRows","recordsLimit","type"],f=!1,g=K.map(a,function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&K.inArray(c,e)>-1&&(b[c]=a[c]);return K.each(["fields","groupByFields"],function(c,d){var e,f=a[d];f&&f.length&&(e=b[d]=[],K.each(f,function(a,b){var c;b.uiOnly?c=b:"childRelationship"===b.type?(c={id:b.id,type:b.type},K.each(["recordsLimit","orderByClause","subConditionLogic"],function(a,d){b.hasOwnProperty(d)&&null!==b[d]&&"undefined"!=typeof b[d]&&(c[d]=b[d])}),b.subConditions&&(c.subConditions=[],b.subConditions.length&&K.each(b.subConditions,function(a,b){var d={};for(var e in b)b.hasOwnProperty(e)&&null!==b[e]&&"undefined"!=typeof b[e]&&(d[e]=b[e]);c.subConditions.push(d)})),b.subFields&&(c.subFields=[],b.subFields.length&&K.each(b.subFields,function(a,d){var e={id:d.id};"undefined"!=typeof b.query&&null!==b.query&&(e.query=e.query),c.subFields.push(e)}))):(c={id:b.id},K.each(["name","function","query"],function(a,d){b.hasOwnProperty(d)&&null!==b[d]&&(c[d]=b[d])})),e.push(c)}))}),K.each(["conditions","havings"],function(c,d){var e,f=a[d];f&&f.length&&(e=b[d]=[],K.each(f,function(a,b){var c=K.extend({},b);for(var d in c)null===c[d]&&delete c[d];e.push(c)}))}),a.needsMetadataLoad&&(f=!0),b});return d=!b||b.loadAllMetadata||f?g:{operationModels:g,options:{excludeMetadata:!0}},l(c).load(d).then(function(a){var b,d=K.Deferred();return K.isArray(a)?d.resolve(a):a&&a.models?(b=a.metadata,b&&L.size(b)&&K.each(b,function(a,b){c.cacheEntityMetadata(a,b)}),d.resolve(a.models)):d.reject("Invalid Response Format"),d.promise()})})},getActions:function(a){return B($("",{isStandard:!0}),a).then(function(a){return function(b,c,d){var e=[{label:"Standard",value:"-",disabled:!0}];return e=e.concat(K.map(a.actions,function(a){return aa(b,c,d,a.name,{isStandard:!0,label:a.label})})).concat([{label:"",value:"-",disabled:!0},{label:"Custom",value:"-",disabled:!0},aa(b,c,d,"apex"),aa(b,c,d,"flow"),aa(b,c,d,"emailAlert",{needSObject:!0}),aa(b,c,d,"quickAction",{needSObject:!0})])}})},getEntityList:function(a){var b=L.sObjectList,c=a.dataSource;return c.name===F&&b?K.Deferred().resolve(b).promise():c.authenticate().then(function(){return l(c).getEntityList()})},search:function(a){var b=a.dataSource;return delete a.dataSource,l(b).doSearch(a).then(function(c){return c.results&&c.results.forEach(function(b,c){b.objectMapKey=a.returning[c].objectMapKey,b.modelName=a.returning[c].modelName}),a.dataSource=b,c.request=a,c})},buildEntityMetadataRequest:function(a){var b=a.targetEntity;return!b&&a.model&&a.model.attr&&(b=a.model.attr("sobject")),{objectName:b}},getEntityMetadataLoadingMessageFromBreadcrumb:function(a){return"Loading metadata for object "+a.endsobject+"..."},getEntityMetadataCacheKey:function(a){return a.objectName},getEntityMetadata:function(a){var b=K.Deferred(),c=a.entities,d=a.dataSource,e=a.ignoreMetadataOverrides?"true":"false";return c?d.authenticate().then(function(){var a=[];K.each(c,function(b,c){var f=K.Deferred(),g=P(c)?c:c.objectName,h={sObjectName:g,loadChildRelationships:"true",loadPicklistValues:"false",ignoreMetadataOverrides:e};if(a.push(f.promise()),!g)return f.reject("Error: no Salesforce Object Name was specified for Model."),!0;c&&c.fields&&c.fields.length&&(h.fieldsToLoad=c.fields.join(","),K.isPlainObject(c.fields[0])&&(h.fieldsToLoad=c.fields.map(function(a){return a.id}).join(","))),l(d).getModelMetadata(h).then(function(a){a?a instanceof Array&&a.length?f.resolve(K.map(a,function(a){return i(a),a})):(i(a),f.resolve(a)):f.resolve(a)},function(a){f.reject("There was an error retrieving metadata for object: "+g+": "+a)})}),K.when.all(a).then(function(a){b.resolve(a)},function(a){b.reject(a&&a.length?a.join(","):"")})},function(a){b.reject("Unable to authenticate to Salesforce. Metadata could not be retrieved. "+a)}):b.reject("No SObject provided."),b.promise()},getImageSources:function(b){var c={label:"Attachment",needsRecordContext:!0,needsFieldContext:!0,relatedObjectName:"skuid__Image__c",automaticFieldMappings:{Attachment:!0,skuid__Image__c:!0},getSrc:q},d={attachment:c};return b&&b.name===F&&(d.staticresource={label:"Static Resource",builderProps:function(b,c,d){var e=d.additionalOnRefresh,f=d.additionalOnRebuildAndRefresh,g=d.prefix||"",h=[],i=g+"resource",j=g+"resourceContentType",k=g+"path",l={},m=!0;return l[i]="{{#NamespacePrefix}}{{{NamespacePrefix}}}__{{/NamespacePrefix}}{{{Name}}}",l[j]="{{{ContentType}}}",c.attr(j)&&(m=c.attr(j)===a.constants.MIME_TYPES.ZIP),h.push(a.platform.builder.getStaticResourceProperty({id:i,valueTemplates:l,onChange:function(){c.attr(k)&&(c.removeAttr(k),b.save()),b.refresh().rebuildProps(),f&&f()}})),c.attr(i)&&m&&h.push(a.platform.builder.getNestedPathProperty({id:k,state:c,nameProperty:i,namespaceProperty:i,onChange:function(){b.refresh(),e&&e()}})),h},getSrc:function(a){var b,c,d=K.Deferred(),e=a.prefix||"",f=a.xmlDef.attr(e+"resource"),g=a.xmlDef.attr(e+"path"),h=a.context,i=a.mergeSettings;return g&&(g=L.mergeAsTextInContext(g,h,i)),f&&(f=L.mergeAsTextInContext(f,h,i))&&(c=f.split("__"),2===c.length&&(b=c[0],f=c[1])),f?d.resolve(L.getStaticResourceUrl(f,b,g)):d.reject("No Resource Provided"),d.promise()}}),d},getReferenceHandler:function(){return{getBaseReferenceProps:function(b){return[{id:"targetobjects",type:"sobject",label:"SObject Type",dataSourceName:a.dataSource.getDataSourceFromXML(b.state).name}]},getOverrideBatchProperties:function(){return[{type:"helptext",html:"Specify fields that will be added as related data. Any fields that are used in search or display templates will need to be added here."}]},getOverrideBatchNoItemsFunction:function(){return function(){return K("<div>").text("(Loading key field only.)")}},getOverrideBatchFieldChildrenFunction:function(a){return function(){return[{id:"batchfield",indent:1,linkedComponent:a,addtooltip:"Add New Batch Load Field",labelFunction:function(a){return a.attr("field")||"[No Field Selected]"},defaultStateFunction:function(){return R("<batchfield/>")},propsFunction:function(b){return[{id:"field",type:"field",label:"Field",sobject:a.state.attr("targetobjects"),dataSourceName:a.state.attr("datasource"),onChange:function(){b.refresh().rebuildProps()}}]}}]}},getMetadataHandler:function(b,c,d,e,f){var g,h=b.children("batchfields").first(),i=h.children("batchfield"),j=b.attr("keyfield")||"Id",k=b.attr("targetobjects"),l=b.attr("ogdisplaytype"),m=b.attr("rel")||e+"__r";if(c.keyField=j,c.originalDisplayType=l,k&&(g=k.split(","),c.isNamePointing=g.length>1,(f||l&&l!==E)&&(c.relationshipName=c.rel=m),c.referenceTo=K.map(g,function(a){return{accessible:!0,objectName:a}}),c.ref=k),!f&&l&&l!==E){var n=a.dataSource.getDataSourceFromXML(b),o=new a.model.Model({dataSource:n});o.id="_ReferenceLabelModel_"+(new Date).getTime()+m,i&&i.length?o.fields=K.map(i,function(a){return{id:K(a).attr("field")}}):o.fields=[{id:j}],o.doQuery=!0,o.doClone=!1,o.objectName=k,o.initialize();var p=new a.model.Condition;p.name="__reference_batch",p.operator="in",o.addCondition(p),d.batchLabelModels||(d.batchLabelModels={}),d.batchLabelModels[e]=o}},getReferenceValue:function(a,b){return a[b.keyField||"Id"]},getRowFromReferenceValue:function(a,b,c){var d=a.getRows([{field:c.keyField||"Id",value:b}]);return d&&d.length?d[0]:{}},processReferenceLookupModel:function(a,b,c){a.objectName=c,"OwnerId"===b.id&&"Group"===c&&a.addCondition({field:"Type",value:"Queue",inactive:!1}),"recordtype"==c.toLowerCase()&&(a.rTypeFor=b.model.objectName,a.addCondition({field:"SObjectType",value:a.rTypeFor,inactive:!1,type:"fieldvalue"}))}}},getUploadMethods:function(){function b(a,b,c,d,e,f){a.size<g?p(a,b,c,d,e,f):s(a,b,c,d,e,f)}function c(a,b,c,d){var e=a.model.objectName,f=a.row.Id,g=this.dataSource,h=a.model.getFieldValue(a.row,b),i={id:"objdelete",updates:{},type:e},j={id:"imagedelete",deletes:{},type:"skuid__Image__c"},k=f;i.updates[k]={},i.updates[k][b]="",j.deletes[h]={},c(),l(g).save(JSON.stringify({operations:[i,j]})).then(function(){d()},function(a){d({message:a})})}function d(b,c,d,e,f){var g=b.row.Id,h=c.attr("id");return this.dataSource.name===F?(a.page.runningOnForceSite?a.page.currentSiteUrl:"/")+"apex/UploadImage?id="+g+(d?"&objfield="+d:"")+"&elid="+h+(e?"&desc="+e:"")+(f?"&filename="+f:""):""}function e(){return this.dataSource.name===F}var f,g=65e4,h={id:"autorefreshmodels",type:"boolean",label:"Auto-refresh related Models on successful upload",defaultValue:!0,helptext:"If true, then upon successful file upload, Skuid will automatically attempt to find related Models that are displaying File data, and Skuid will cancel changes in these Models and then re-query them."};return f={record:{label:"In Attachment to Record",relatedObjectName:"Attachment",needsRecordContext:!0,forceStoreAsFileName:!0,upload:b,getSrc:q,deleteFile:c,supportsIframeUpload:e,getIframeSrc:d,builderProps:[{id:"owneridfield",helpText:"If left blank, owner of record will be creator of attachment",type:"field",addFieldToModel:!0,label:"Custom Owner Id Field",modelprop:"model"}]},chatterfeed:{label:"In Chatter Feed Item",relatedObjectName:"ContentVersion",needsRecordContext:!0,upload:s,builderProps:[{id:"feedtext",type:"text",label:"Feed Text"}]},field:{label:"In Field on Record",needsRecordContext:!0,needsFieldContext:!0,upload:b,getSrc:q,deleteFile:c,supportsIframeUpload:e,getIframeSrc:d,getFileIdField:function(a){return a.substr(0,a.length-1)+"r.skuid__AttachmentId__c"},getFileNameField:function(a){return a.substr(0,a.length-1)+"r.Name"}},chatterfiles:{label:"In Chatter Files",relatedObjectName:"ContentVersion",upload:s},contentdocument:{label:"In Content Document",relatedObjectName:"ContentVersion",upload:s},staticresource:{label:"In Static Resource",canRunPostUploadSnippet:!0,upload:t,hideInBuilder:!0}},K.each(f,function(a,b){if(b.relatedObjectName){var c=b.builderProps;c||(c=b.builderProps=[]),c.push(h)}}),f},getDefaultFieldsForReferenceField:function(a,b,c){var d,e=b.referenceTo[0].objectName,f=[];return d=b.referenceTo.length<2?L.getFieldReference(a,b,c):L.getFieldRelationshipName(a,b)+".Name",f.push(d),"skuid__Image__c"===e&&f.push(L.getFieldRelationshipName(a,b)+".skuid__AttachmentId__c"),f},getNameFieldURLForReferenceField:function(d,g,h){var i=d.options.fieldXML,j=i&&i.attr("redirecttype")||"datasourcedefault",k=a.dataSource.DataSourceType.prototype.getNameFieldURLForReferenceField;if("datasourcedefault"!==j)return k(d,g,h);if(b(d.model)){var l='<a href="',m=c(),n=f(),o=e(),p=g;return l+=o?"#/sObject/"+p+'/view"':m?'#" onclick="sforce.one.navigateToSObject(\''+p+"');":n?'#" onclick="skuid.ui.openConsoleTabForField(\''+T(d._GUID)+"','"+T(d.model.id)+"','"+p+"');":L.getSafeRelativeUrl("/"+p),l+='" tabindex="-1">'+h+"</a>"}},getNameFieldURLForTextField:function(a,d,g){var h,i,j=a.metadata,k=a.model,l=g,m=a.row,n=k.getRowId(m),o=j&&"URL"===j.displaytype,p=c(),q=f(),r=e(),s=d,t=["FirstName","LastName","Company"];return!k.isSingleRow()&&b(k)&&L.userInfo.isAuthenticated&&(j&&j.nameField||-1!==K.inArray(a.id,t))&&!k.isNewRow(m)&&-1===a.id.indexOf(".")&&!a.options.noLink?(s=l,l='<a href="',(l+=r?"#/sObject/"+n+'/view"':p?'#" onclick="sforce.one.navigateToSObject(\''+n+"');":q?'#" onclick="skuid.ui.openConsoleTabForNameField(\''+n+"','"+T(k.id)+"');":L.getSafeRelativeUrl("/"+n))+'">'+T(s)+"</a>"):o?(h=l&&U(l,"/"),i=T(s),p?'<a href="#" onclick="sforce.one.navigateToURL(\''+i+"');\">"+T(l)+"</a>":q&&h?'<a href="#" onclick="skuid.ui.openConsoleTabForUrl(\''+i+"','"+i+"');\">"+T(l)+"</a>":'<a href="'+i+'"'+(q?' target="blank"':"")+">"+T(l)+"</a>"):void 0},getModelProperties:function(b,c){var d=a.builder.core,e=b.state,f=function(){return(e.attr("datasource")||e.attr("service")||F)===F},g=d.getUnsavedChangesWarningProperty({component:b}),h=d.getCoreModelBasicProperties({component:b,propViewer:c}),i=[];return h.push({id:"sobject",type:"sobject",dataSourceTypeName:this.name,
dataSourceName:e.attr("datasource")||e.attr("service"),label:"Salesforce Object Name",onChange:function(){b.refresh(),a.mobile&&a.mobile.processResponsiveElements()}},d.getModelTypeProperty({component:b}),d.getModelQueryOnPageLoadProperty({component:b,propViewer:c}),d.getModelLimitProperty(),d.getModelOrderByProperty(),d.getCreateDefaultRowProperty()),f()&&"aggregate"!==e.attr("type")&&i.push({id:"doclone",type:"picklist",label:"Clone data returned by Model query",helptext:"Should all data returned by querying this Model be 'cloned', meaning that data in the Model will be marked as 'New' so that when the Model is saved, new records will be created, rather than updates made to existing records?",picklistEntries:[{label:"Yes, always",value:"yes"},{label:"Yes, if 'clone' and 'id' parameters are present in URL",value:""},{label:"No",value:"no"}],defaultValue:""}),i.push({id:"queryallrows",type:"boolean",label:"Query Deleted / Archived records",helptext:'For developers: adds the SOQL "ALL ROWS" clause to your query. If true, then deleted records and/or archived Tasks will be included in your Model\'s query --- by default, they are not.'},{id:"forview",type:"boolean",label:'Update Salesforce "Recently Viewed" info',helptext:"For developers: adds the SOQL \"FOR VIEW\" clause to your query. Use this if you want this Model to feed into Salesforce's tracking of Recently Viewed Items. When this Model's query is run, the LastViewedDate for all records in this Model will be updated, and new records will be added to the RecentlyViewed object. "}),f()?(i.push({id:"processonclient",type:"boolean",defaultValue:d.pageModel.getFieldValue(d.pageRow,"skuid__MasterPage__c")&&"true"===d.getMasterPageXML().attr("cachepage"),onChange:function(){b.refresh().rebuildProps()},label:"Process Model client-side",helptext:"If this page, or its master page, has Page Caching enabled, this is HIGHLY RECOMMENDED, unless you expect this Model's data to rarely change. Causes Skuid to construct this Model client-side in JavaScript rather than server-side, which prevents your Model metadata and data from being cached, which could result in stale / inaccurate metadata/data being presented to your users."}),"true"===e.attr("processonclient")&&h.push(d.getAsyncLoadProperty())):h.push(d.getAsyncLoadProperty()),g&&i.push(g),Array.prototype.push.apply(i,d.getModelLabelProperties()),[{name:"Basic",props:h},{name:"Advanced",props:i}]},processModelXMLExtensions:function(a,b){a.extensions={salesforce:{objectName:b.attr("sobject"),type:b.attr("type"),queryAllRows:"true"===b.attr("queryallrows"),forView:"true"===b.attr("forview")}}},isDataSourceNativeSalesforce:Y,initialize:i,properties:{composer:{supports:{childRelationships:!0},canFieldsBeSelected:function(a){return!!a.breadcrumb.endsobject||"Select an SObject for this Model"}},canAutoGenerateConditionsFromFields:!0,validConditionTypes:["fieldvalue","multiple","param","userinfo","blank","modelmerge","join"],canConditionsBeGrouped:!0,hasGlobalSearchEntities:!0}})}(skuid);